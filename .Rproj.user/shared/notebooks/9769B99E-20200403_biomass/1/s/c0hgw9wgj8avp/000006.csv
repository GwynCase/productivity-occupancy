"0","# Redo the biomass calculation on a per-site basis."
"0","site.mass <- items %>% "
"0","  mutate(mass=as.numeric(mass)) %>% "
"0","  group_by(site) %>% "
"0","  mutate(s.mass=sum(mass)) %>% "
"0","  ungroup() %>% "
"0","  group_by(site, common) %>% "
"0","  mutate(biomass=sum(mass), p.biomass=(biomass/s.mass*100)) %>% "
"0","  mutate(p.biomass=round(p.biomass, digits=2)) %>% "
"0","  ungroup()"
"0","# Pull out prey all prey items which match these criteria."
"0","top.items <- semi_join(site.mass, top.prey, by='common') %>% "
"0","  unite(name, 4:5, sep=' ', remove=FALSE) %>% "
"0","  mutate(name=case_when("
"0","    name == 'Unknown unknown' ~ ' ',"
"0","    TRUE ~ name"
"0","  )) %>% "
"0","  dplyr::select(site, common, p.biomass) %>% "
"0","  distinct()"
"0","# Reorganize the data."
"0","top.table <- top.items %>% spread(common, p.biomass) %>% "
"0","  replace(is.na(.), 0) %>% "
"0","  mutate(total = rowSums(.[2:11]))"
"0","# And make a pretty table."
"0","top.table %>%"
"0","  mutate_if(is.numeric, function(x) {"
"0","    cell_spec(x, bold = T, "
"0","              color = spec_color(x, end=0.9, direction=-1, scale_from=range(0, 55)))"
"0","  }) %>%"
"0","  kable(escape=F) %>%"
"0","  kable_styling(full_width = F)"
