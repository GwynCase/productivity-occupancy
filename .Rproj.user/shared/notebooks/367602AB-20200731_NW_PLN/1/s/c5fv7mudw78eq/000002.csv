"0","# Diversity of land cover."
"0",""
"0","# Bring in land cover data."
"0","r.landcover <- raster('../data/processed/vri_sc_all-sites.tif')"
"0",""
"0","# Define land cover levels."
"0","landcover.levels <- data.frame(ID=0:11, class.name="
"0","                                     c('undefined', 'rock', 'ocean', 'freshwater',"
"0","                                       'alpine', 'wetland',"
"0","                                       'shrub', 'deciduous', 'regen',"
"0","                                       'young', 'mature', 'old'))"
"0",""
"0","# Add levels to raster."
"0","levels(r.landcover) <- landcover.levels"
"0",""
"0","# Assign CRS."
"0","crs(r.landcover) <- CRS('+proj=utm +zone=10 +datum=NAD83 +units=m +no_defs')"
"0",""
"0","# For now, make a vector of camera nest names."
"0","cam.nests <- cameras.sf$nest"
"0",""
"0","# Make a list of metrics to calculate."
"0","landcover.metrics <- c('lsm_l_core_mn', 'lsm_l_area_mn', 'lsm_c_pland', 'lsm_l_ed',"
"0","                       'lsm_l_enn_mn', 'lsm_l_pd', 'lsm_l_contag', 'lsm_l_iji',"
"0","                       'lsm_l_prd', 'lsm_l_sidi', 'lsm_l_siei')"
"0",""
"0","# Make a function to do the calculations and formatting."
"0","# For now stick to camera sites only."
"0","calc.landcover.metrics <- function(x) {"
"0","  sample_lsm(r.landcover, y=sites.sf, size=x, plot_id=nests, shape='circle', what=landcover.metrics) %>% "
"0","    left_join(landcover.levels, by=c('class'='ID')) %>% "
"0","    mutate(class.name=ifelse(is.na(class.name), metric, class.name)) %>% "
"0","    select(-class, -metric, -level) %>%  "
"0","    pivot_wider(names_from=class.name, values_from=value) %>% "
"0","    mutate(radius=x)"
"0","}"
"0",""
"0","# Run the function for each sample size."
"0","landcover.landscape.metrics <- map_df(landscape$radius, calc.landcover.metrics)"
"0",""
"0","# Do some cleanup: fill NAs with zeros and rename columns, calculate mature forest."
"0","landcover.landscape.metrics <- landcover.landscape.metrics %>% #replace(is.na(.), 0) %>% "
"0","  select(nest=plot_id, "
"0","         cover.core=core_mn, cover.size=area_mn, cover.edge.density=ed,"
"0","         cover.n.neighbor=enn_mn, cover.patch.density=pd, cover.contagion=contag, cover.interspersion=iji,"
"0","         cover.richness=prd, cover.diversity=sidi, cover.evenness=siei,"
"0","         everything(), "
"0","         -layer, -id, -percentage_inside) %>% "
"0","  mutate(amount.cover.mature=mature + old)"
"0",""
"0","landcover.landscape.metrics <- select(landscape, radius, size) %>% right_join(landcover.landscape.metrics)"
"0",""
"0","landcover.landscape.metrics %>% "
"0","  mutate(size=fct_reorder(size, radius)) %>% "
"0","  select(nest, size, undefined, rock, ocean, freshwater,"
"0","                                       shrub, deciduous, regen,"
"0","                                       young, mature, old) %>% "
"0","  pivot_longer(-c(nest, size), names_to='metric', values_to='values') %>% "
"0","  ggplot(aes(x=metric, y=values, fill=size)) +"
"0","  geom_boxplot() +"
"0","  geom_jitter() +"
"0","  scale_fill_brewer(palette='Set2') +"
"0","  theme_classic() +"
"0","  facet_wrap(~size) +"
"0","  theme(legend.position='none') +"
"0","  coord_flip()"
