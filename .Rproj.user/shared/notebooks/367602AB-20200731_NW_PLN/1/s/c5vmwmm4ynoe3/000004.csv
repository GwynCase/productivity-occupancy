"0","# Import raster data for BEC zones."
"0","r.bec <- raster('../data/external/bec_raster_full.tif')"
"0",""
"0","# Get BEC levels."
"0","bec.levels <- levels(r.bec) %>% data.frame()"
"0",""
"0","# Assign CRS."
"0","crs(r.bec) <- CRS('+proj=utm +zone=10 +datum=NAD83 +units=m +no_defs')"
"0",""
"0","# Make a vector of the nest names."
"0","nests <- sites.sf$nest"
"0",""
"0","# Make a list of metrics to calculate."
"0","bec.metrics <- c('lsm_c_ca', 'lsm_l_pr', 'lsm_l_sidi')"
"0",""
"0","# Make a function to do the calculations and formatting."
"0","calc.bec.metrics <- function(x) {"
"0","  sample_lsm(r.bec, y=sites.sf, size=x, plot_id=nests, shape='circle', what=bec.metrics) %>% "
"0","    left_join(bec.levels, by=c('class'='ID')) %>% "
"0","    group_by(plot_id, metric) %>% "
"0","    top_n(1, value) %>% ungroup() %>%  "
"0","    fill(category) %>% "
"0","    filter(level == 'landscape') %>% "
"0","    pivot_wider(names_from=metric, values_from=value) %>% "
"0","    mutate(radius=x)"
"0","}"
"0",""
"0","# Run the function for each sample size."
"0","bec.landscape.metrics <- map_df(landscape$radius, calc.bec.metrics)"
"0",""
"0","# Tidy things up."
"0","bec.landscape.metrics <- bec.landscape.metrics %>% "
"0","  select(nest=plot_id, dominant.bec=category, bec.richness=pr, bec.diversity=sidi, radius)"
"0",""
"0","bec.landscape.metrics <- select(landscape, radius, size) %>% right_join(bec.landscape.metrics, by='radius')"
