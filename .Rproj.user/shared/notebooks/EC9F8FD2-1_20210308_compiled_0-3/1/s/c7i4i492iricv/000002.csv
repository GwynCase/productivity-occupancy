"0","# Make a function to calculate class mass."
"0","class.mass <- function(data) {"
"0","    data %>% mutate(total.mass=sum(.data$mass)) %>%"
"0","    filter(class %in% c('Mammalia', 'Aves')) %>%"
"0","    group_by(class) %>% "
"0","    mutate(class.mass=sum(.data$mass), per.class=class.mass/total.mass*100) %>% "
"0","    distinct(class, per.class) %>% "
"0","    rename(variable=class, percent=per.class)"
"0","}"
"0",""
"0","# And a function to calculate squirrel mass."
"0","squirrel.mass <- function(data) {"
"0","    data %>% mutate(total.mass=sum(.data$mass)) %>%"
"0","    filter(genus == 'Tamiasciurus') %>%"
"0","    mutate(genus.mass=sum(.data$mass), per.genus=genus.mass/total.mass*100) %>% "
"0","    distinct(genus, per.genus) %>% "
"0","    rename(variable=genus, percent=per.genus)"
"0","}"
"0",""
"0","# Calculate biomass for study area. Start with % mammals and % birds."
"0","study.area.mass <- diet.items %>% group_by(source) %>% nest() %>%  "
"0","  mutate(n=map(data, class.mass)) %>% unnest(n) %>% "
"0","  select(source, variable, percent) %>% "
"0","  pivot_wider(names_from=source, values_from=percent)"
"0",""
"0","# Add % squirrels."
"0","study.area.mass <- diet.items %>% group_by(source) %>% nest() %>%  "
"0","  mutate(n=map(data, squirrel.mass)) %>% unnest(n) %>% "
"0","  select(source, variable, percent) %>% "
"0","  pivot_wider(names_from=source, values_from=percent) %>% "
"0","  bind_rows(study.area.mass)"
"0",""
"0","# Clean up."
"0","study.area.mass <- study.area.mass %>% mutate(R.P=R + P) %>% "
"0","  select(variable, C, P, R.P)"
