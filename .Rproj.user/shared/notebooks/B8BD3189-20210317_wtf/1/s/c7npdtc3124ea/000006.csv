"0","# Take only items identified to genus and twist to a wide format."
"0","camera.diet.wide <- diet.items %>% filter(binomial != 'Unidentified item' & method == 'camera') %>% "
"0","  group_by(nest, genus, species) %>% "
"0","  mutate(count=n()) %>% ungroup() %>% "
"0","  dplyr::select(nest, binomial, count) %>%"
"0","  distinct() %>% "
"0","  pivot_wider(names_from=binomial, values_from=count,"
"0","              values_fill=list(count = 0))"
"0",""
"0","# Calculate diet diversity."
"0","camera.diet.diversity <- plyr::ddply(camera.diet.wide, ~nest, function(x) {"
"0","           data.frame(diet.diversity=diversity(x[-1], index='simpson'))"
"0","   })"
"0",""
"0","# Proportion of diet made up of squirrel, by biomass."
"0","camera.proportion.squirrel <- diet.items %>% "
"0","  filter(method == 'camera') %>% "
"0","  mutate(mass=as.numeric(mass)) %>% "
"0","  group_by(nest) %>% "
"0","  mutate(total=sum(mass)) %>% "
"0","  filter(genus == 'Tamiasciurus') %>% "
"0","  mutate(amount.sq=sum(mass), proportion.squirrel=amount.sq/total) %>% "
"0","  select(nest, proportion.squirrel) %>% distinct()"
"0",""
"0","# Proportion of diet made up of mammal, by biomass."
"0","camera.proportion.mammal <- diet.items %>% "
"0","  filter(method == 'camera') %>% "
"0","  mutate(mass=as.numeric(mass)) %>% "
"0","  group_by(nest) %>% "
"0","  mutate(total=sum(mass)) %>% "
"0","  filter(class == 'Mammalia') %>% "
"0","  mutate(amount.mm=sum(mass), proportion.mammal=amount.mm/total) %>% "
"0","  select(nest, total, proportion.mammal) %>% distinct()"
"0",""
"0","# Join them together."
"0","camera.diet.variables <- full_join(camera.diet.diversity, camera.proportion.mammal, by=c('nest')) %>% "
"0","  full_join(camera.proportion.squirrel, by=c('nest'))"
"0",""
"0","# Bring in productivity data."
"0","camera.sites.2019 <- read_csv('../data/raw/camera_nests_2019.csv')"
"0",""
"0","# Add productivity to dataset."
"0","camera.diet.variables <- camera.sites.2019 %>% select(nest, site, n_fledge) %>% "
"0","  full_join(camera.diet.variables, by=c('nest'))"
"0",""
"0","st.vars <- camera.diet.variables"
"0",""
"0","st.vars"
