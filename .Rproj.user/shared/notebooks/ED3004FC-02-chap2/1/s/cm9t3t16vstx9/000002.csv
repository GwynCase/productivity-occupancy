"0","# Make half the data frame for the graph."
"0","chi.graph <- left_join(diet.items, centroids.sf, by=c('site')) %>% "
"0","  group_by(source, zone) %>% "
"0","  mutate(total.count=n()) %>% "
"0","  distinct(source, zone, total.count) %>% "
"0","  pivot_wider(names_from=source, values_from=total.count) %>% "
"0","  mutate(RP=R + P) %>% "
"0","  pivot_longer(!zone, names_to='source', values_to='total.count')"
"0",""
"0","# Make the other half of the data frame, then join."
"0","chi.graph <- left_join(diet.items, centroids.sf, by=c('site')) %>% "
"0","  group_by(source, zone, group) %>% "
"0","  mutate(group.count=n()) %>% "
"0","  distinct(source, zone, group, group.count) %>% "
"0","  pivot_wider(names_from=source, values_from=group.count, values_fill=0) %>% "
"0","  mutate(RP=R + P) %>% "
"0","  pivot_longer(-c(group, zone), names_to='source', values_to='group.count') %>% "
"0","  right_join(chi.graph, by=c('zone', 'source')) %>% "
"0","  filter(source != 'R') %>% "
"0","  mutate(prop=group.count/total.count) %>% "
"0","  mutate(group=case_when("
"0","  group == 'corvid' ~ 'Corvids',"
"0","  group == 'grouse' ~ 'Grouse',"
"0","  group == 'thrush' ~ 'Thrushes',"
"0","  group == 'bird' ~ 'Other\n Birds',"
"0","  group == 'hare' ~ 'Hares',"
"0","  group == 'squirrel' ~ 'Pine\n Squirrels',"
"0","  group == 'mammal' ~ 'Other\n Mammals',"
"0","  group == 'unknown' ~ 'Unknown'"
"0",")) %>% "
"0","  mutate(group=factor(group, "
"0","    levels=c('Other\n Birds', 'Corvids', 'Grouse', 'Thrushes', "
"0","    'Other\n Mammals', 'Hares', 'Pine\n Squirrels', 'Unknown'))) %>% "
"0","  mutate(source=factor(source,"
"0","                       levels=c('P', 'RP', 'C')))"
"0",""
"0","# Source names for facet labels."
"0","source_names <- list("
"0","  'P'='Pellets',"
"0","  'RP'='Pooled Pellets-and-Remains',"
"0","  'C'='Nest cameras'"
"0",")"
"0",""
"0","# Labeller function."
"0","labeller <- function(variable, value) {"
"0","  return(source_names[value])"
"0","}"
