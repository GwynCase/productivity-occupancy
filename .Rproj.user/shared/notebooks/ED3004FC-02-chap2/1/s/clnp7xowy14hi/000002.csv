"0","# Make the data frame."
"0","prey.table <- diet.items %>% distinct(category, class, family, genus, species, common, mass) %>%"
"0","  mutate(mass=round(mass, digits=1)) %>% "
"0","  arrange(category, common, mass) %>%"
"0","  group_by(category, common) %>% "
"0","  slice_tail(1) %>% ungroup() %>%"
"0","  mutate(group=category) %>% "
"0","#  arrange(class, category, family, genus, species, mass) %>%"
"0","  separate(category, c('size', 'type')) %>% "
"0","  mutate(mass=round(mass, digits=1)) %>% "
"0","  mutate(common=case_when("
"0","    common == 'unknown' & genus =='Unknown' ~ paste('average', size, type),"
"0","    common == 'grouse' ~'unidentified grouse',"
"0","    TRUE ~ common"
"0","  )) %>%"
"0","  mutate(species=case_when("
"0","    species == 'unknown' & genus != 'Unknown' ~ 'sp',"
"0","    species =='unknown' ~ NA_character_,"
"0","    TRUE ~ species"
"0","  )) %>%"
"0","  mutate(genus=case_when("
"0","    common == 'vole' ~ 'Subfamily: Avicolinae',"
"0","    common == 'unidentified grouse' ~ 'Subfamily: Tentraoninae',"
"0","    genus == 'Unknown' ~ NA_character_,"
"0","    TRUE ~ genus"
"0","  )) %>%"
"0","  mutate(genus=case_when("
"0","    species != 'NA' ~ paste0('\\textit{', genus, '}'),"
"0","    TRUE ~ genus"
"0","  )) %>%"
"0","  mutate(species=case_when("
"0","    species == 'sp' ~ 'sp.',"
"0","    species != 'sp' ~ paste0('\\textit{', species, '}'),"
"0","    genus == NA ~ NA_character_"
"0","  )) %>%"
"0","  mutate(family=case_when("
"0","    genus == NA ~ 'Unknown',"
"0","    TRUE ~ family"
"0","  )) %>% "
"0","  mutate(binomial=case_when("
"0","    is.na(genus) | is.na(species) ~ coalesce(genus, species),"
"0","    TRUE ~ paste(genus, species)"
"0","  )) %>% "
"0","  arrange(class, group, genus, species) %>%"
"0","  select(common, binomial, mass) %>% "
"0","  mutate(common=str_to_title(common))"
"0",""
"0","# Unfortunately, we also need a separate version for word."
"0","prey.table.word <- diet.items %>% distinct(category, class, family, genus, species, common, mass) %>%"
"0","  mutate(mass=round(mass, digits=1)) %>% "
"0","  arrange(category, common, mass) %>%"
"0","  group_by(category, common) %>% "
"0","  slice_tail(1) %>% ungroup() %>%"
"0","  mutate(group=category) %>% "
"0","#  arrange(class, category, family, genus, species, mass) %>%"
"0","  separate(category, c('size', 'type')) %>% "
"0","  mutate(mass=round(mass, digits=1)) %>% "
"0","  mutate(common=case_when("
"0","    common == 'unknown' & genus =='Unknown' ~ paste('average', size, type),"
"0","    common == 'grouse' ~'unidentified grouse',"
"0","    TRUE ~ common"
"0","  )) %>%"
"0","  mutate(species=case_when("
"0","    species == 'unknown' & genus != 'Unknown' ~ 'sp',"
"0","    species =='unknown' ~ NA_character_,"
"0","    TRUE ~ species"
"0","  )) %>%"
"0","  mutate(genus=case_when("
"0","    common == 'vole' ~ 'Subfamily: Avicolinae',"
"0","    common == 'unidentified grouse' ~ 'Subfamily: Tentraoninae',"
"0","    genus == 'Unknown' ~ NA_character_,"
"0","    TRUE ~ genus"
"0","  )) %>%"
"0","  mutate(family=case_when("
"0","    genus == NA ~ 'Unknown',"
"0","    TRUE ~ family"
"0","  )) %>% "
"0","  mutate(binomial=case_when("
"0","    is.na(genus) | is.na(species) ~ coalesce(genus, species),"
"0","    TRUE ~ paste(genus, species)"
"0","  )) %>% "
"0","  arrange(class, group, genus, species) %>%"
"0","  select(group, common, binomial, mass) %>% "
"0","  mutate(common=str_to_title(common))"
