"0","# Bring in occupancy data."
"0","occupancy.history <- read_csv('../data/processed/occupancy_sc.csv')"
"0","## In this dataset: "
"0","# 0 = not visited"
"0","# 1 = visited, no detection"
"0","# 2 = visited, with detection"
"0","# 3 = visited, breeding"
"0",""
"0","# Remove problem child Turbid Creek. This site has a known error with the GIS data."
"0","occupancy.history <- filter(occupancy.history, site != 'TCR')"
"0",""
"0","# Remove any sites that have never been visited (status in all years = 0)."
"0","occupancy.history <- occupancy.history %>% "
"0","  filter_at(vars(starts_with('status')), any_vars(. > 0))"
"0",""
"0","# Twist occupancy data long."
"0","occupancy.data <- occupancy.history %>% "
"0","  pivot_longer(-c(site, name), names_to='year', values_to='status') %>% "
"0","  filter(status > 0) %>%"
"0","  group_by(site, status) %>% "
"0","  add_tally() %>% "
"0","  distinct(site, status, .keep_all=TRUE) %>% "
"0","  select(-year) %>% "
"0","  pivot_wider(names_from=status, values_from=n, values_fill=0) %>% "
"0","  ungroup() %>% rowwise(site, name) %>% "
"0","  mutate(years.surveyed=sum(c(`3`, `2`, `1`)),"
"0","         years.detect=sum(c(`3`, `2`)),"
"0","         years.no.detect=years.surveyed-years.detect) %>%"
"0","  select(site, name, years.surveyed, years.detect, years.no.detect)"
"0",""
"0","# Bring in calculated landscape data."
"0","landscape.data <- read_csv('../data/processed/landscape_metrics_plain.csv')"
"0",""
"0","# Join to occupancy data."
"0","occupancy.data <- occupancy.data %>% left_join(landscape.data, by=c('site'='nest'))"
"0",""
"0","# Filter out everything with insufficient GIS coverage (less than 90%)."
"0","occupancy.data <- occupancy.data %>% group_by(site) %>% "
"0","  filter(across(contains('inside'), ~all(.>=90)))"
