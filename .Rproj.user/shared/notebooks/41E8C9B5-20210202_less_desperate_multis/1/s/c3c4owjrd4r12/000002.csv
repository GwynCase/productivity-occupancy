"0","# Separate out the data."
"0","pfa.data <- df %>% filter(size == 'PFA')"
"0",""
"0","# Re-write the top model on its own."
"0","top.model <- glm(cbind(years.detect, years.no.detect) ~ proportion.cover.mature + "
"0","                   gap.edge.density, data=pfa.data, family=binomial(logit))"
"0",""
"0","# Create a grid and add predictions."
"0","fake <- data_grid(pfa.data, gap.edge.density, .model=top.model) %>% "
"0","  mutate(pred=predict(top.model, newdata=., type='response'))"
"0",""
"0","# Grab the inverse link function from the model."
"0","inv <- family(top.model)$linkinv"
"0",""
"0","# Add fit and SE data."
"0","fake <- bind_cols(fake, setNames(as_tibble(predict(top.model, fake, se.fit = TRUE)[1:2]),"
"0","                           c('fit.link','se.link')))"
"0",""
"0","# Create confidence interval."
"0","fake <- fake %>% mutate(fit.resp  = inv(fit.link),"
"0","                  right.upr = inv(fit.link + (2 * se.link)),"
"0","                  right.lwr = inv(fit.link - (2 * se.link)))"
"0",""
"0","# Plot them?"
"0","ggplot(fake, aes(x=gap.edge.density, y=pred)) +"
"0","  geom_line() +"
"0","  geom_ribbon(aes(ymin=right.lwr, ymax=right.upr), alpha=0.1) +"
"0","  geom_point(data=pfa.data, aes(x=gap.edge.density, y=quality.index)) +"
"0","  theme_classic()"
