kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 2) %>%
pack_rows('Mount Ford', 3, 4) %>%
pack_rows('Ruby Lake', 5, 6) %>%
pack_rows('Turbid Creek', 7, 8) %>%
pack_rows('Twenty-Mile Creek', 9, 10) %>%
pack_rows('Utziletz', 11, 12)
mass.by.genus <- to.genus %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
group_by(site, genus, species) %>%
mutate(amount=sum(mass)) %>%
ungroup() %>%
mutate(prop=amount/total) %>%
dplyr::select(site, class, family, genus, species, amount, total, prop) %>%
arrange(site, class) %>%
distinct()
mass.by.genus %>% dplyr::select(-site, -total) %>%
kable(digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 7) %>%
pack_rows('Mount Ford', 8, 14) %>%
pack_rows('Ruby Lake', 15, 16) %>%
pack_rows('Turbid Creek', 17, 22) %>%
pack_rows('Twenty-Mile Creek', 23, 25) %>%
pack_rows('Utziletz', 26, 33)
mass.by.family <- to.family %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
group_by(site, family) %>%
mutate(amount=sum(mass)) %>%
ungroup() %>%
mutate(prop=amount/total) %>%
dplyr::select(site, class, family, amount, total, prop) %>%
arrange(site, class) %>%
distinct()
mass.by.family %>% dplyr::select(-site, -total) %>%
kable(digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 4) %>%
pack_rows('Mount Ford', 5, 9) %>%
pack_rows('Ruby Lake', 10, 12) %>%
pack_rows('Turbid Creek', 13, 18) %>%
pack_rows('Twenty-Mile Creek', 19, 22) %>%
pack_rows('Utziletz', 23, 27)
mass.by.class <- to.class %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
group_by(site, class) %>%
mutate(amount=sum(mass)) %>%
ungroup() %>%
mutate(prop=amount/total) %>%
dplyr::select(site, class, amount, total, prop) %>%
arrange(site, class) %>%
distinct()
mass.by.class %>% dplyr::select(-site, -total) %>%
kable(digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 2) %>%
pack_rows('Mount Ford', 3, 4) %>%
pack_rows('Ruby Lake', 5, 6) %>%
pack_rows('Turbid Creek', 7, 8) %>%
pack_rows('Twenty-Mile Creek', 9, 10) %>%
pack_rows('Utziletz', 11, 12)
365+393.8
758.8/2
571.5+475.3
1046.8/2
1272+839
2111/2
72.65+67.8
140.45/2
29.7+29.9
59.6/2
80.3+78.4
158.7/2
84.8+75
159.8/2
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
n.nests <- df %>% distinct(site) %>% summarize(n()) %>% as.numeric()
install.date <- df %>% group_by(site) %>% summarize(d=min(datetime)) %>%
mutate(day=day(d), m=month(d))
df %>% filter(site=='TMC')
df %>% filter(site=='TMC') %>%
filter(live.chicks == 0)
df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime)
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime)
df %>% filter(site=='TMC') %>%
summarize(min(datetime))
df %>% filter(site=='TMC') %>%
summarize(min(datetime)) %>%
yday()
df %>% filter(site=='TMC') %>%
summarize(min(datetime)) %>%
lubridate::yday()
df %>% filter(site=='TMC') %>%
summarize(date=min(datetime)) %>%
yday(date)
df %>% filter(site=='TMC') %>%
summarize(date=min(datetime))
df %>% filter(site=='TMC') %>%
summarize(date=min(datetime)) %>%
yday()
TMC.first.date <- df %>% filter(site=='TMC') %>%
summarize(date=min(datetime))
yday(TMC.first.date)
class(TMC.first.date)
df$datetime
df$datetime %>% class()
class(TMC.fail.date)
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime) %>%
ymd:hms()
ymd::hms(TMC.first.date)
ymd:hms(TMC.first.date)
View(TMC.fail.date)
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime) %>%
as.numeric()
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime) %>%
ymd:hms()
View(TMC.first.date)
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime) %>%
as.character()
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime) %>%
as.character()
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime) %>%
as.character() %>%
ymd:hms()
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime) %>%
TMC.first.date <- df %>% filter(site=='TMC') %>%
summarize(date=min(datetime))
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
dplyr::select(datetime)
df %>% ymd_hms(datetime)
View(df)
ymd_hms(df$datetime)
class(df$datetime)
yday(df$datetime)
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
mutate(day=yday(datetime))
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
mutate(day=yday(datetime)) %>%
filter(live.chick == 0)
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
mutate(day=yday(datetime)) %>%
filter(live.chicks == 0)
TMC.fail.date <- df %>% filter(site=='TMC') %>%
filter(live.chicks == 0) %>%
mutate(day=yday(datetime)) %>%
filter(live.chicks == 0) %>%
dplyr::select(day)
TMC.fail.date
class(TMC.fail.date)
as.numeric(TMC.fail.date)
TMC.first.date <- df %>% filter(site=='TMC') %>%
mutate(day=yday(datetime)) %>%
summarzie(min(day))
TMC.first.date <- df %>% filter(site=='TMC') %>%
mutate(day=yday(datetime)) %>%
summarize(min(day)) %>%
dplyr::select(day)
TMC.first.date <- df %>% filter(site=='TMC') %>%
mutate(day=yday(datetime))
TMC.first.date <- df %>% filter(site=='TMC') %>%
mutate(day=yday(datetime)) %>%
summarize(min(day))
View(TMC.first.date)
as.numeric(TMC.fail.date) - as.numeric(TMC.first.date)
# Import basic camera nest data
cameras <- read.csv('../data/raw/productivity_2019.csv', stringsAsFactors=FALSE)
# Do the date conversion thing.
cameras <- cameras %>% mutate(date=ymd(date), branch=ymd(branch), fledge=ymd(fledge))
View(cameras)
cameras %>% group_by(n_fledge) %>%
summarize(n())
cameras %>% group_by(n_fledge) %>%
summarize(n=n())
cameras %>% group_by(n_fledge) %>%
summarize(n=n()) %>%
filter(n_fledge==1) %>%
as.numeric(n)
cameras %>% group_by(n_fledge) %>%
summarize(n=n()) %>%
filter(n_fledge==3) %>%
as.numeric(n)
cameras %>% group_by(n_fledge) %>%
summarize(n=n()) %>%
filter(n_fledge==3) %>%
dplyr::select(n) %>%
as.numeric(n)
n.fledge <- cameras %>% group_by(n_fledge) %>%
summarize(n=n())
View(n.fledge)
n.fledge[2,2]
n.fledge[3,2]
n.fledge[3,]
n.fledge[3, 2]
View(cameras)
nrows(df)
nrow(df)
df %>% filter(interest %in% c('newprey', 'delivery'))
df %>% filter(interest %in% c('newprey', 'delivery')) %>% nrow()
df %>% filter(class != 'Unknown') %>% nrow()
df %>% mutate(total=nrow())
df %>% mutate(total=nrow()) %>%
mutate(total=n()) %>%
filter(class != 'Unknown')
df %>% mutate(total=n()) %>%
filter(class != 'Unknown')
df %>% filter(interest %in% c('newprey', 'delivery')) %>%
mutate(total=n()) %>%
filter(class != 'Unknown') %>%
mutate(IDd=n(), prop=IDd/total)
df %>% filter(interest %in% c('newprey', 'delivery')) %>%
mutate(total=n()) %>%
filter(class != 'Unknown') %>%
mutate(IDd=n(), prop=IDd/total*100)
# Import prey items data
source('../src/prey_attributes.R')
# Filter out just the prey items delivered.
# Remove complete unknowns (ie, no class or size).
items <- df %>% filter(class != '') %>%
filter(size != 'Unknown') %>%
dplyr::select(site, class, family, genus, species, common, size) %>%
arrange(class, family, genus, species, size)
# Classify each avian item into a size class.
items <- items %>% mutate(group=case_when(
# Band-tailed pigeon
species == 'fasciata' ~ 'Large bird',
# Ruffed grouse
species == 'umbellus' ~ 'Large bird',
# Sooty grouse
species == 'fulignosus' ~ 'Large bird',
# Steller's jay
species == 'stelleri' ~ 'Medium bird',
# Gray jay
species == 'canadensis' ~ 'Medium bird',
# Swainson's thrush
species == 'ustulatus' ~ 'Small bird',
# Varied thrush
species == 'naevius' ~ 'Medium bird',
# American robin
species == 'migratorius' ~ 'Medium bird',
# Unknown small bird
class == 'Aves' & species == 'unknown' & size == 'Small' ~ 'Small bird',
# Unknown medium bird
class == 'Aves' & species == 'unknown' & size == 'Medium' ~ 'Medium bird',
# Unknown large bird
class == 'Aves' & species == 'unknown' & size == 'Large' ~ 'Large bird',
TRUE ~ 'group'))
# Add a common name for items not IDed to species.
items <- items %>% mutate(common=case_when(
class == 'Aves' & species == 'unknown' & size == 'Small' ~ 'average small bird',
class == 'Aves' & species == 'unknown' & size == 'Medium' ~ 'average medium bird',
class == 'Aves' & species == 'unknown' & size == 'Large' ~ 'average large bird',
TRUE ~ common))
# Fil in mass for known bird species.
items <- items %>% mutate(mass=case_when(
# Band-tailed pigeon (# from S. BC)
species == 'fasciata' ~ 379.4,
# Ruffed grouse (# from Alberta)
species == 'umbellus' ~ 523.4,
# Sooty grouse (from Vancouver & Harwicke Islands)
species == 'fulignosus' ~ 1055.5,
# Steller's jay (W. Canada)
species == 'stelleri' ~ 128,
# Gray jay (P. c. pacificus, Alaska)
species == 'canadensis' ~ 70.2
# Swainson's thrush (Idaho)
species == 'ustulatus' ~ 29.8,
# Varied thrush ("breeding grounds")
species == 'naevius' ~ 79.35,
# American robin
species == 'migratorius' ~ 79.9,
TRUE ~ 0))
# Fil in mass for known bird species.
items <- items %>% mutate(mass=case_when(
# Band-tailed pigeon (# from S. BC)
species == 'fasciata' ~ 379.4,
# Ruffed grouse (# from Alberta)
species == 'umbellus' ~ 523.4,
# Sooty grouse (from Vancouver & Harwicke Islands)
species == 'fulignosus' ~ 1055.5,
# Steller's jay (W. Canada)
species == 'stelleri' ~ 128,
# Gray jay (P. c. pacificus, Alaska)
species == 'canadensis' ~ 70.2,
# Swainson's thrush (Idaho)
species == 'ustulatus' ~ 29.8,
# Varied thrush ("breeding grounds")
species == 'naevius' ~ 79.35,
# American robin
species == 'migratorius' ~ 79.9,
TRUE ~ 0))
# Assign each mammal to a size group.
items <- items %>% mutate(group=case_when(
# Snowshoe hare
species == 'americanus' ~ 'Large mammal',
# Rat sp.
genus == 'Rattus' ~ 'Medium mammal',
# Bushy-tailed woodrat
species == 'cinerea' ~ 'Medium mammal',
# Northern flying squirrel
species == 'sabrinus' ~ 'Small mammal',
# Chipmunk
genus == 'Neotamias' ~ 'Small mammal',
# Douglas & red squirrels
genus == 'Tamiasciurus' ~ 'Medium mammal',
# Bat
genus == 'Myotis' ~ 'Small mammal',
# Unknown small mammal
class == 'Mammalia' & species == 'unknown' & size == 'Small' ~ 'Small mammal',
# Unknown medium mammal
class == 'Mammalia' & species == 'unknown' & size == 'Medium' ~ 'Medium mammal',
# Unknown large mammal
class == 'Mammalia' & species == 'unknown' & size == 'Large' ~ 'Large mammal',
TRUE ~ group))
# Add common name for mammals not IDed to species.
items <- items %>% mutate(common=case_when(
class == 'Mammalia' & species == 'unknown' & size == 'Small' ~ 'average small mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Medium' ~ 'average medium mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Large' ~ 'average large mammal',
TRUE ~ common))
# Fil in mass for known mammal species.
items <- items %>% mutate(mass=case_when(
# Snowshoe hare
species == 'americanus' ~ 1340,
# Rat
genus == 'Rattus' ~ 269.8,
# Bush-tailed woodrat
species == 'cinerea' ~ 374.7,
# Northern flying-squirrel
species == 'sabrinus' ~ 155.5,
# Chipmunk
genus == 'Neotamias' ~ 66.4,
# Red squirrel
species == 'hudsonicus' ~ 224.5,
# Douglas squirrel
species == 'douglasii' ~ 203.5,
# Unknown tree squirrel
genus == 'Tamiasciurus' & species == 'sp' ~ 214,
# Bat
genus == 'Myotis' ~ 5.8,
TRUE ~ mass))
# Assign a group for items of unknown class.
items <- items %>% mutate(group=case_when(
class == 'Unknown' & size == 'Medium' ~ 'Medium item',
class == 'Unknown' & size == 'Small' ~ 'Small item',
TRUE ~ group))
# Add a common name for items of unknown class.
items <- items %>% mutate(common=case_when(
class == 'Unknown' & size == 'Medium' ~ 'average medium item',
class == 'Unknown' & size == 'Small' ~ 'average small item',
TRUE ~ common))
# Calculate the mean mass of each class/size.
m.mass <- items %>% filter(mass != 0) %>%
group_by(group) %>%
summarise(mean=mean(mass))
# Add to the list of prey items.
items <- left_join(items, m.mass, by='group') %>%
mutate(mass = ifelse(mass > 1, mass, mean)) %>%
dplyr::select(-mean)
# Calculate average small item.
sm <- items %>% filter(group %in% c('Small mammal', 'Small bird')) %>%
distinct(mass) %>%
summarize(mean(mass))
# Calculate average medium item.
md <- items %>% filter(group %in% c('Medium mammal', 'Medium bird')) %>%
distinct(mass) %>%
summarize(mean(mass))
# Insert into table.
items <- items %>% mutate(mass=replace(mass, group=='Small item', sm),
mass=replace(mass, group=='Medium item', md))
df %>% filter(interest %in% c('newprey', 'delivery')) %>% nrow()
nrow(items)
# How many deliveries?
n.del <- df %>% filter(interest %in% c('newprey', 'delivery')) %>% nrow()
items %>% filter(class != 'Unknown') %>% nrow()
n.to.class <- items %>% filter(class != 'Unknown') %>% nrow()
# How many idetnified to genus?
n.to.genus <- items %>% filter(genus != 'Unknown') %>% nrow()
n.to.class/n.del
n.to.class/n.del*100
round(n.to.class/n.del*100, digits=2)
round(n.to.class/n.del*100, digits=0)
nrow(items)
nrow(n.del)
n.del
as.numeric(n.del)
n.del-nrow(items)
n.del-nrow(items)/n.del
(n.del-nrow(items))/n.del
(n.del-nrow(items))/n.del*100
items %>% filter(genus != 'Unknown') %>%
distinct()
items %>% filter(genus != 'Unknown') %>%
group_by(genus, species) %>%
distinct()
items %>% filter(genus != 'Unknown') %>%
dplyr::select(genus, species) %>%
distinct()
items %>% filter(genus != 'Unknown') %>%
dplyr::select(genus, species) %>%
distinct() %>%
summarize(n())
View(items)
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass))
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass))
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(s.mass=sum(mass), p.mass.s=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(j.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(sp.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(sq.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(sq.mass/t.mass)*100) %>%
dplyr::select(p.mass.sq) %>% distinct() %>% as.numeric() %>%
round()
45+17+14
69+17+14
