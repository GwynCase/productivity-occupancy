dplyr::select(site, date, live.chicks) %>%
drop_na() %>%
group_by(site, date) %>%
summarize(max(live.chicks)) %>%
ungroup() %>% group(site)
complete(nesting(site), date=seq(min(date), max(date), by='day'))
chicks <- df %>% mutate(date=date(datetime)) %>%
dplyr::select(site, date, live.chicks) %>%
drop_na() %>%
group_by(site, date) %>%
summarize(max(live.chicks)) %>%
ungroup() %>% group(site) %>%
complete(nesting(site), date=seq(min(date), max(date), by='day'))
chicks <- df %>% mutate(date=date(datetime)) %>%
dplyr::select(site, date, live.chicks) %>%
drop_na() %>%
group_by(site, date) %>%
summarize(max(live.chicks)) %>%
ungroup() %>% group_by(site) %>%
complete(nesting(site), date=seq(min(date), max(date), by='day'))
library('tidyverse')
library('lubridate')
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
chicks <- df %>% mutate(date=date(datetime)) %>%
dplyr::select(site, date, live.chicks) %>%
drop_na() %>%
group_by(site, date) %>%
summarize(max(live.chicks)) %>%
ungroup() %>% group_by(site) %>%
complete(nesting(site), date=seq(min(date), max(date), by='day'))
head(chicks)
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
nests <- read.csv('../data/raw/camera_nests_2019.csv', stringsAsFactors=FALSE)
View(nests)
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
source('../src/prey_attributes_date.R')
mass.for.model <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
nests <- read.csv('../data/raw/camera_nests_2019.csv', stringsAsFactors=FALSE)
View(mass.for.model)
# Do the datetime thing.
nests <- nests %>% mutate(est_hatch=ymd(est_hatch))
age <- nests %>% dplyr::select(site, est_hatch)
View(age)
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch+40)
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch+40) %>%
pivot_longer(cols=2:3, names_to='LH')
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch+40) %>%
pivot_longer(cols=2:3)
age <- nests %>% dplyr::select(site, est_hatch)# %>%
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch+40) %>%
pivot_longer(cols=2:3)
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch+40) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 0,
name == 'fledge' ~ 40
))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 0,
name == 'fledge' ~ 35
))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 0,
name == 'fledge' ~ 35
)) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 0,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 0,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
complete(nesting(site), age=seq(min(age), max(age)))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 1,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
complete(nesting(site), age=seq(min(age), max(age)))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))# %>%
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=complete(age, seq(1:35)))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=complete(age, seq(0:35)))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 1,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))# %>%
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 1,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))%>%
complete(nesting(site), age=seq(1:35))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 1,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))#%>%
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 1,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))%>%
mutate(age=complete(nesting(site), age=seq(1:35)))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 1,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))%>%
mutate(age=complete(age=seq(1:35)))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 1,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))%>%
complete(nesting(site), age=seq(1:35)))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 1,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))%>%
complete(nesting(site), age=seq(1:35))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
mutate(age=case_when(
name == 'est_hatch' ~ 1,
name == 'fledge' ~ 35
)) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'),
age=seq(1:35))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day'))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:35))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 35) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(0:35))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 34) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:35))
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 34) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:35)) %>%
dplyr::select(-name)
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 34) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:35), date=value) %>%
dplyr::select(site, date, age)
View(mass.for.model)
left_join(mass.for.model, age)
mass.for.model <- left_join(mass.for.model, age)
View(mass.for.model)
# Table with date and age for each site.
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 39) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:40), date=value) %>%
dplyr::select(site, date, age)
mass.for.model <- left_join(mass.for.model, age)
View(age)
mass.for.model <- left_join(mass.for.model, age)
mass.for.model <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
mass.for.model <- left_join(mass.for.model, age)
mass.for.model <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
# Table with date and age for each site.
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 49) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:50), date=value) %>%
dplyr::select(site, date, age)
mass.for.model <- left_join(mass.for.model, age)
View(mass.for.model)
# Table with date and age for each site.
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 99) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:100), date=value) %>%
dplyr::select(site, date, age)
mass.for.model <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
mass.for.model <- left_join(mass.for.model, age)
mass.for.model <- items.alt %>%
mutate(date=date(datetime), log.mass=log(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
View(mass.for.model)
mass.for.model <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass), log.d.mass=log(d.mass)+1) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass, log.d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
mass.for.model <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass), log.d.mass=ln(d.mass)) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass, log.d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
mass.for.model <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass), log.d.mass=log(d.mass)) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass, log.d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
# Table with date and age for each site.
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 99) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:100), date=value) %>%
dplyr::select(site, date, age)
mass <- lm(log.d.mass ~ age, data=mass.for.model)
# Now graft them together.
mass.for.model <- left_join(mass.for.model, age) %>%
mutate(age=as.numeric(age))
mass <- lm(log.d.mass ~ age, data=mass.for.model)
summary(mass)
resid(mass)
plot(mass)
ggplot(mass.for.model, aes(x=age, y=log.d.mass)) +
geom_point() +
theme_classic()
predict(mass)
data.frame(p.mass=predict(mass, mass.for.model), age=mass.for.model$age)
ggplot(mass.for.model, aes(x=age, y=log.d.mass)) +
geom_point() +
theme_classic() +
geom_smooth(method='lm', formula= log.d.mass ~ age)
ggplot(mass.for.model, aes(x=age, y=log.d.mass)) +
geom_point() +
theme_classic() +
geom_smooth(method='lm', formula=y ~ x)
ggplot(mass.for.model, aes(x=age, y=log.d.mass)) +
geom_point() +
theme_classic() +
geom_smooth(method='lm', formula=y ~ x, se=FALSE)
ggplot(mass.for.model, aes(x=age, y=log.d.mass)) +
geom_point() +
theme_classic() +
geom_smooth(method='lm', formula=y ~ x, se=FALSE)
ggplot(mass.for.model, aes(x=age, y=log.d.mass)) +
geom_point() +
theme_classic() +
geom_smooth(method='lm', formula=y ~ x, se=FALSE)
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
source('../src/prey_attributes_date.R')
mass.for.model <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass), log.d.mass=log(d.mass)) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass, log.d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
# Import data.
nests <- read.csv('../data/raw/camera_nests_2019.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
nests <- nests %>% mutate(est_hatch=ymd(est_hatch))
# Table with date and age for each site.
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 99) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:100), date=value) %>%
dplyr::select(site, date, age)
# Now graft them together.
mass.for.model <- left_join(mass.for.model, age) %>%
mutate(age=as.numeric(age))
mass <- lm(log.d.mass ~ age, data=mass.for.model)
summary(mass)
ggplot(mass.for.model, aes(x=age, y=log.d.mass)) +
geom_point() +
theme_classic() +
geom_smooth(method='lm', formula=y ~ x, se=FALSE)
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
n.nests <- df %>% distinct(site) %>% summarize(n()) %>% as.numeric()
install.date <- df %>% group_by(site) %>% summarize(d=min(datetime)) %>%
mutate(day=day(d), m=month(d))
# Import prey items data
source('../src/prey_attributes.R')
# Import basic camera nest data
cameras <- read.csv('../data/raw/productivity_2019.csv', stringsAsFactors=FALSE)
# Do the date conversion thing.
cameras <- cameras %>% mutate(date=ymd(date), branch=ymd(branch), fledge=ymd(fledge))
# How many fledged?
n.fledge <- cameras %>% group_by(n_fledge) %>%
summarize(n=n())
# How many deliveries?
n.del <- df %>% filter(interest %in% c('newprey', 'delivery')) %>% nrow()
# How many identified to class?
n.to.class <- items %>% filter(class != 'Unknown') %>% nrow()
# How many idetnified to genus?
n.to.genus <- items %>% filter(genus != 'Unknown') %>% nrow()
del.per.day <- df %>% filter(interest %in% c('delivery', 'newprey')) %>%
mutate(day=date(datetime)) %>%
group_by(site) %>%
mutate(first=min(day), last=max(day), n.day=last-first) %>%
add_count(site, day, name='n.del') %>%
add_count(site, name='t.del') %>%
mutate(n.day=as.numeric(n.day), per.day=t.del/n.day) %>%
dplyr::select(site, day, n.day, n.del, t.del) %>%
distinct() %>%
complete(nesting(site), day=seq(min(day), max(day), by='day')) %>%
fill(n.day, t.del) %>%
mutate(n.del=replace_na(n.del, 0))
source('../src/prey_attributes_date.R')
mass.by.day <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
arrange(site, date) %>%
distinct() %>%
ungroup() %>% group_by(site) %>%
complete(nesting(site), date=seq(min(date), max(date), by='day')) %>%
mutate(d.mass=replace_na(d.mass, 0))
View(mass.for.model)
ggplot(mass.for.model, aes(x=age, y=log.d.mass)) +
geom_point() +
theme_classic() +
facet_wrap(~site)
ggplot(mass.for.model, aes(x=age, y=d.mass)) +
geom_point() +
theme_classic() +
facet_wrap(~site)
plot(mass)
coef(summary(mass))
str(summary(mass))
# And make a model.
m.mass.by.age <- lm(log.d.mass ~ age, data=mass.for.model)
sum.mass.by.age <- summary(m.mass.by.age)
str(sum.mass.by.age)
summary(m.mass.by.age)$coefficients[,4]
summary(m.mass.by.age)$coefficients[2,4]
summary(m.mass.by.age)$coefficients[2,4] %>% round(digits=2)
