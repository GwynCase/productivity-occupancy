# Plot it.
ggplot(ml.tz, aes(x=amt.tz, y=ratio, label=site)) +
geom_point() +
geom_text(hjust='inward', nudge_y = 0.5) +
geom_smooth(method='lm', se=FALSE, color='black', linetype='dashed') +
theme_classic()
tz.ml.tz <- ml.tz %>% filter(amt.tz > 1000)
# Pick just the sites with more than 1000 ha of tz-type habitats.
tz.ml.tz <- ml.tz %>% filter(amt.tz > 1000)
# Plot it.
ggplot(tz.ml.tz, aes(x=amt.tz, y=ratio, label=site)) +
geom_point() +
geom_text(hjust='inward', nudge_y = 0.5) +
geom_smooth(method='lm', se=FALSE, color='black', linetype='dashed') +
theme_classic()
# And model it.
lm(ratio ~ amt.tz, data=tz.ml.tz) %>% summary()
View(df)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv')
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of mammal biomass per site.
mammal.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(amount.ml=sum(mass), prop.ml=amount.ml/total) %>%
dplyr::select(site, prop.ml) %>% distinct()
mammal.mass
# Calculate proportion of mammal biomass per site.
avian.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(class == 'Aves') %>%
mutate(amount.av=sum(mass), prop.av=amount.av/total) %>%
dplyr::select(site, prop.av) %>% distinct()
avian.mass
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv')
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv')
# Filter out just the prey items delivered.
# Remove complete unknowns (ie, no class or size).
items <- df %>% filter(class != '') %>%
filter(size != 'Unknown') %>%
dplyr::select(site, class, family, genus, species, common, size) %>%
arrange(class, family, genus, species, size)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv')
problems()
View(df)
source('../src/prey_attributes.R', guess_max=7000)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max = min(1000, n_max))
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
source('../src/prey_attributes.R')
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sp=amount.sp/total) %>%
dplyr::select(site, prop.ml) %>% distinct()
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sp=amount.sq/total) %>%
dplyr::select(site, prop.ml) %>% distinct()
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sq=amount.sq/total) %>%
dplyr::select(site, prop.sq) %>% distinct()
sq.mass
# Import transition zone shapefile.
vri <- st_read('../data/external/VRI_camera-sites_2019.shp')
# Look at it.
ggplot() +
geom_sf(data=vri) +
theme_classic()
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sq=amount.sq/total) %>%
dplyr::select(site, prop.sq) %>% distinct()
sq.mass
# Import transition zone shapefile.
vri <- st_read('../data/external/VRI_camera-sites_2019.shp')
# Look at it.
ggplot() +
geom_sf(data=vri) +
theme_classic()
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 &in& c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == TC ~ 4,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == TC ~ 4,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == 'TC' ~ 5,
TRUE ~ 0
))
vri.class
vri.class %>% group_by(class) %>% summarise(n())
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 < 10 ~ 5,
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 10 & < 30 ~ 6,
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 30 & < 100 ~ 7,
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 < 10 ~ 5,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 10 & < 30 ~ 6,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 30 & < 100 ~ 7,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == 'TC' ~ 5
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 < 10 ~ 5,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 10 & < 30 ~ 6,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 30 & < 100 ~ 7,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == 'TC' ~ 5,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 < 10 ~ 5,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 10 & < 30 ~ 6,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 30 & < 100 ~ 7,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == 'TC' ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 10 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 10 & PROJ_AGE_1 < 30 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 30 & PROJ_AGE_1 < 100 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
# See how it turned out.
vri.class %>% group_by(class) %>% summarise(n())
# What are all these things classed as 0s?
vri.class %>% filter(class == 0) %>%
group_by(BCLCS_LV_1, BCLCS_LV_4) %>%
summarize(n())
vri.class %>% filter(class == 0) %>%
group_by(BCLCS_LV_1, BCLCS_LV_4) %>%
summarize(n())
# Assign to classes.
# Regen/young/mature/old ages come from Zharikov et al. 2007
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TB', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
vri.class %>% filter(class == 0 & BCLCS_LV_4 == 'TC') %>%
dplyr::select(PROJ_AGE_1)
# See how it turned out.
vri.class %>% group_by(class) %>% summarise(n())
# See how it turned out.
vri.class %>% group_by(class) %>% summarise(n())
# Set raster extent based on tz shapefile.
ext <- extent(vri)
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sq=amount.sq/total) %>%
dplyr::select(site, prop.sq) %>% distinct()
sq.mass
# Import transition zone shapefile.
vri <- st_read('../data/external/VRI_camera-sites_2019.shp')
# Look at it.
ggplot() +
geom_sf(data=vri) +
theme_classic()
# Assign to classes.
# Regen/young/mature/old ages come from Zharikov et al. 2007
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TB', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
# See how it turned out.
vri.class %>% group_by(class) %>% summarise(n())
# Set raster extent based on tz shapefile.
ext <- extent(vri)
# Make an empty raster to populate with values.
r <- raster(ext, res=c(100, 100))
# Populate BEC polygon data onto empty raster grid.
r.vri <- rasterize(vri, r, 'class')
# Populate BEC polygon data onto empty raster grid.
r.vri <- rasterize(vri, r, class)
vri.class$class %>% head()
5+6
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sq=amount.sq/total) %>%
dplyr::select(site, prop.sq) %>% distinct()
sq.mass
# Import transition zone shapefile.
vri <- st_read('../data/external/VRI_camera-sites_2019.shp')
# Look at it.
ggplot() +
geom_sf(data=vri) +
theme_classic()
# Assign to classes.
# Regen/young/mature/old ages come from Zharikov et al. 2007
vri.class <- vri %>% mutate(hab.class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TB', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
# See how it turned out.
vri.class %>% group_by(hab.class) %>% summarise(n())
# Set raster extent based on tz shapefile.
ext <- extent(vri)
# Make an empty raster to populate with values.
r <- raster(ext, res=c(100, 100))
vri.class$hab.class %>% head()
vri.class$hab.class %>% class()
class(vri.class)
r.vri <- rasterize(vri, r, 'hab.class')
r.vri <- rasterize(vri.class, r, 'hab.class')
dataframe(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested',
'deciduous', 'regen', 'young', 'mature', 'old'))
tibble(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested',
'deciduous', 'regen', 'young', 'mature', 'old'))
data.frame(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested',
'deciduous', 'regen', 'young', 'mature', 'old'))
# Create labels for raster.
levels <- data.frame(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested', 'deciduous', 'regen', 'young', 'mature', 'old'))
# Create labels for raster.
vri. levels <- data.frame(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested', 'deciduous', 'regen', 'young', 'mature', 'old'))
# Create labels for raster.
vri.levels <- data.frame(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested', 'deciduous', 'regen', 'young', 'mature', 'old'))
# Add them to the raster.
levels(r.vri) <- vri.levels
# Create labels for raster.
vri.levels <- data.frame(ID=0:8, class.name=c('undefined', 'water', 'land', 'unforested', 'deciduous', 'regen', 'young', 'mature', 'old'))
# Add them to the raster.
levels(r.vri) <- vri.levels
# Save the raster image.
writeRaster(r.vri, '../data/interim/vri_camera-sites_2019.tif', format='GTiff')
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sq=amount.sq/total) %>%
dplyr::select(site, prop.sq) %>% distinct()
sq.mass
# Import transition zone shapefile.
vri <- st_read('../data/external/VRI_camera-sites_2019.shp')
# Assign to classes.
# Regen/young/mature/old ages come from Zharikov et al. 2007
vri.class <- vri %>% mutate(hab.class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TB', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
# See how it turned out.
vri.class %>% group_by(hab.class) %>% summarise(n())
4+5
# Import the raster.
r.vri <- raster('../data/interim/vri_camera-sites_2019.tif')
# Import nests and calculate centroids.
sites <- read_csv('../data/processed/the_big_list_of_nests.csv') %>%
group_by(name) %>%
mutate_at(c('lat', 'lon'), mean) %>%
mutate_at(vars(starts_with('status')), max) %>%
mutate_at(c('telemetry', 'cameras', 'remains'), max) %>%
dplyr::select(-nest, -NOTES) %>%
distinct() %>%
filter(cameras > 0)
