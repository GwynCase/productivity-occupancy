species == 'fulignosus' ~ 'Phasianidae',
TRUE ~ family
)
)
# And another. This was a juvenile...
df <- df %>% mutate(size=case_when(
family == 'Turdidae' & size == 'Unknown' ~ 'Small',
TRUE ~ size))
# Fill in a bit of missing data.
df <- df %>% mutate(species=case_when(
genus == 'Tamiasciurus' & species == 'unknown' ~ 'sp',
genus == 'Myotis' ~ 'sp',
TRUE ~ species
))
df <- df %>% mutate(common=case_when(
genus == 'Myotis' ~ 'bat',
genus == 'Tamiasciurus' & species == 'sp' ~ 'tree squirrel',
TRUE ~ common
))
# Get all unique instances.
items <- df %>% filter(class != '') %>%
dplyr::select(class, family, genus, species, common, size) %>%
distinct()
items
# I double-checked the photos on these unknowns.
df <- df %>% mutate(size=case_when(
class=='Aves' & size == 'Unknown' ~ 'Small',
class=='Mammalia' & size == 'Unknown' ~ 'Medium',
TRUE ~ size
))
# Get unique instances, discarding complete unknowns.
items <- df %>% filter(class != '') %>%
filter(size != 'Unknown') %>%
dplyr::select(class, family, genus, species, common, size) %>%
arrange(class, family, genus, species, size) %>%
distinct()
# Avian size groups.
items <- items %>% mutate(group=case_when(
species == 'fasciata' ~ 'Large bird',
species == 'umbellus' ~ 'Large bird',
species == 'fulignosus' ~ 'Large bird',
species == 'stelleri' ~ 'Medium bird',
species == 'canadensis' ~ 'Medium bird',
species == 'ustulatus' ~ 'Small bird',
species == 'naevius' ~ 'Medium bird',
species == 'migratorius' ~ 'Medium bird',
class == 'Aves' & species == 'unknown' & size == 'Small' ~ 'Small bird',
class == 'Aves' & species == 'unknown' & size == 'Medium' ~ 'Medium bird',
class == 'Aves' & species == 'unknown' & size == 'Large' ~ 'Large bird',
TRUE ~ 'group'))
# Group the unknown bird species by size.
items <- items %>% mutate(common=case_when(
class == 'Aves' & species == 'unknown' & size == 'Small' ~ 'average small bird',
class == 'Aves' & species == 'unknown' & size == 'Medium' ~ 'average medium bird',
class == 'Aves' & species == 'unknown' & size == 'Large' ~ 'average large bird',
TRUE ~ common))
# Fil in mass for known bird species.
items <- items %>% mutate(mass=case_when(
species == 'fasciata' ~ 392,
species == 'umbellus' ~ 600,
species == 'fulignosus' ~ 600,
species == 'stelleri' ~ 120,
species == 'canadensis' ~ 67.5,
species == 'ustulatus' ~ 34,
species == 'naevius' ~ 82.5,
species == 'migratorius' ~ 77,
TRUE ~ 0))
# Assign each mammal to a size group.
items <- items %>% mutate(group=case_when(
species == 'americanus' ~ 'Large mammal',
genus == 'Rattus' ~ 'Medium mammal',
species == 'cinerea' ~ 'Medium mammal',
species == 'sabrinus' ~ 'Small mammal',
genus == 'Neotamias' ~ 'Small mammal',
genus == 'Tamiasciurus' ~ 'Medium mammal',
genus == 'Myotis' ~ 'Small mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Small' ~ 'Small mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Medium' ~ 'Medium mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Large' ~ 'Large mammal',
TRUE ~ group))
# Group the unknown mammal species by size.
items <- items %>% mutate(common=case_when(
class == 'Mammalia' & species == 'unknown' & size == 'Small' ~ 'average small mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Medium' ~ 'average medium mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Large' ~ 'average large mammal',
TRUE ~ common))
# Fil in mass for known bird species.
items <- items %>% mutate(mass=case_when(
species == 'americanus' ~ 1340,
genus == 'Rattus' ~ 269.8,
species == 'cinerea' ~ 374.7,
species == 'sabrinus' ~ 155.5,
genus == 'Neotamias' ~ 66.4,
species == 'hudsonicus' ~ 224.5,
species == 'douglasii' ~ 203.5,
genus == 'Tamiasciurus' & species == 'sp' ~ 214,
genus == 'Myotis' ~ 5.8,
TRUE ~ mass))
# A last few unknowns.
items <- items %>% mutate(group=case_when(
class == 'Unknown' & size == 'Medium' ~ 'Medium item',
class == 'Unknown' & size == 'Small' ~ 'Small item',
TRUE ~ group))
items <- items %>% mutate(common=case_when(
class == 'Unknown' & size == 'Medium' ~ 'average medium item',
class == 'Unknown' & size == 'Small' ~ 'average small item',
TRUE ~ common))
# Make it pretty.
items <- items %>% unite(name, 3:4, sep=' ', remove=FALSE) %>%
mutate(name=case_when(
name == 'Unknown unknown' ~ ' ',
TRUE ~ name
)) %>%
arrange(class, group, genus)
prey.table <- items %>% dplyr::select(common, name, mass) %>%
distinct() %>%
kable(col.names=c('Prey category', '', 'Mass (g)')) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Large birds (> 150 g)', 1, 3) %>%
pack_rows('Medium birds (60-150 g)', 4, 8) %>%
pack_rows('Small birds (< 40 g)', 9, 10) %>%
pack_rows('Large mammals (> 600 g)', 11, 12) %>%
pack_rows('Medium mammals (200-600 g)', 13, 18) %>%
pack_rows('Small mammals (< 200 g)', 19, 22) %>%
pack_rows('Unidentified items', 23, 24)
# Calculate averages per group.
m.mass <- items %>% filter(mass != 0) %>%
group_by(group) %>%
summarise(mean=mean(mass))
m.mass
items <- left_join(items, m.mass, by='group') %>%
mutate(mass = ifelse(mass > 1, mass, mean)) %>%
dplyr::select(-mean)
# Calculate average small item.
sm <- items %>% filter(group %in% c('Small mammal', 'Small bird')) %>%
distinct(mass) %>%
summarize(mean(mass))
# Calculate average medium item.
md <- items %>% filter(group %in% c('Medium mammal', 'Medium bird')) %>%
distinct(mass) %>%
summarize(mean(mass))
# Plug it in.
items <- items %>% mutate(mass=replace(mass, group=='Small item', sm),
mass=replace(mass, group=='Medium item', md))
prey.table
items %>% dplyr::select(common, name, mass) %>%
distinct() %>%
kable(col.names=c('Prey category', '', 'Mass (g)')) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Large birds (> 150 g)', 1, 3) %>%
pack_rows('Medium birds (60-150 g)', 4, 8) %>%
pack_rows('Small birds (< 40 g)', 9, 10) %>%
pack_rows('Large mammals (> 600 g)', 11, 12) %>%
pack_rows('Medium mammals (200-600 g)', 13, 18) %>%
pack_rows('Small mammals (< 200 g)', 19, 22) %>%
pack_rows('Unidentified items', 23, 24)
View(items)
items %>% dplyr::select(common, name, mass)
items %>% dplyr::select(common, name, mass) %>%
distinct()
class(items$common)
class(items$name)
class(items$mass)
items2 <- dplyr::select(common, name, mass) %>%
mutate(mass=as.numeric(mass))
items2 <- items %>% dplyr::select(common, name, mass) %>%
mutate(mass=as.numeric(mass))
class(items2$mass)
items2 %>% dplyr::select(common, name, mass) %>%
distinct()
items %>% dplyr::select(common, name, mass) %>%
mutate(mass=as.numeric(mass, digits=2))
items %>% dplyr::select(common, name, mass) %>%
mutate(mass=as.numeric(mass)) %>%
distinct()
items %>% dplyr::select(common, name, mass) %>%
mutate(mass=as.numeric(mass)) %>%
distinct() %>%
kable(col.names=c('Prey category', '', 'Mass (g)')) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Large birds (> 150 g)', 1, 3) %>%
pack_rows('Medium birds (60-150 g)', 4, 8) %>%
pack_rows('Small birds (< 40 g)', 9, 10) %>%
pack_rows('Large mammals (> 600 g)', 11, 12) %>%
pack_rows('Medium mammals (200-600 g)', 13, 18) %>%
pack_rows('Small mammals (< 200 g)', 19, 22) %>%
pack_rows('Unidentified items', 23, 24)
items %>% dplyr::select(common, name, mass) %>%
mutate(mass=as.numeric(mass)) %>%
distinct() %>%
kable(col.names=c('Prey category', '', 'Mass (g)')) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Large birds (> 150 g)', 1, 3) %>%
pack_rows('Medium birds (60-150 g)', 4, 8) %>%
pack_rows('Small birds (< 40 g)', 9, 10) %>%
pack_rows('Large mammals (> 600 g)', 11, 12) %>%
pack_rows('Medium mammals (200-600 g)', 13, 18) %>%
pack_rows('Small mammals (< 200 g)', 19, 22) %>%
pack_rows('Unidentified items', 23, 24)
items %>% dplyr::select(common, name, mass) %>%
mutate(mass=as.numeric(mass)) %>%
distinct() %>%
kable(col.names=c('Prey category', '', 'Mass (g)'), digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Large birds (> 150 g)', 1, 3) %>%
pack_rows('Medium birds (60-150 g)', 4, 8) %>%
pack_rows('Small birds (< 40 g)', 9, 10) %>%
pack_rows('Large mammals (> 600 g)', 11, 12) %>%
pack_rows('Medium mammals (200-600 g)', 13, 18) %>%
pack_rows('Small mammals (< 200 g)', 19, 22) %>%
pack_rows('Unidentified items', 23, 24)
View(df)
write.csv(df, '../data/interim/camera_corrected.csv', row.names=FALSE)
View(df)
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
View(items)
items2 <- df %>% filter(class != '') %>%
filter(size != 'Unknown') %>%
dplyr::select(class, family, genus, species, common, size) %>%
arrange(class, family, genus, species, size)
View(items2)
items2 <- items2 %>% mutate(group=case_when(
species == 'fasciata' ~ 'Large bird',
species == 'umbellus' ~ 'Large bird',
species == 'fulignosus' ~ 'Large bird',
species == 'stelleri' ~ 'Medium bird',
species == 'canadensis' ~ 'Medium bird',
species == 'ustulatus' ~ 'Small bird',
species == 'naevius' ~ 'Medium bird',
species == 'migratorius' ~ 'Medium bird',
class == 'Aves' & species == 'unknown' & size == 'Small' ~ 'Small bird',
class == 'Aves' & species == 'unknown' & size == 'Medium' ~ 'Medium bird',
class == 'Aves' & species == 'unknown' & size == 'Large' ~ 'Large bird',
TRUE ~ 'group'))
# Import the data.
df2 <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Filter out just the prey items delivered.
# Remove complete unknowns (ie, no class or size).
items <- df2 %>% filter(class != '') %>%
filter(size != 'Unknown') %>%
dplyr::select(class, family, genus, species, common, size) %>%
arrange(class, family, genus, species, size)
# Classify each avian item into a size class.
items <- items %>% mutate(group=case_when(
# Band-tailed pigeon
species == 'fasciata' ~ 'Large bird',
# Ruffed grouse
species == 'umbellus' ~ 'Large bird',
# Sooty grouse
species == 'fulignosus' ~ 'Large bird',
# Steller's jay
species == 'stelleri' ~ 'Medium bird',
# Gray jay
species == 'canadensis' ~ 'Medium bird',
# Swainson's thrush
species == 'ustulatus' ~ 'Small bird',
# Varied thrush
species == 'naevius' ~ 'Medium bird',
# American robin
species == 'migratorius' ~ 'Medium bird',
# Unknown small bird
class == 'Aves' & species == 'unknown' & size == 'Small' ~ 'Small bird',
# Unknown medium bird
class == 'Aves' & species == 'unknown' & size == 'Medium' ~ 'Medium bird',
# Unknown large bird
class == 'Aves' & species == 'unknown' & size == 'Large' ~ 'Large bird',
TRUE ~ 'group'))
# Add a common name for items not IDed to species.
items <- items %>% mutate(common=case_when(
class == 'Aves' & species == 'unknown' & size == 'Small' ~ 'average small bird',
class == 'Aves' & species == 'unknown' & size == 'Medium' ~ 'average medium bird',
class == 'Aves' & species == 'unknown' & size == 'Large' ~ 'average large bird',
TRUE ~ common))
# Fil in mass for known bird species.
items <- items %>% mutate(mass=case_when(
# Band-tailed pigeon
species == 'fasciata' ~ 392,
# Ruffed grouse
species == 'umbellus' ~ 600,
# Sooty grouse
species == 'fulignosus' ~ 600,
# Steller's jay
species == 'stelleri' ~ 120,
# Gray jay
species == 'canadensis' ~ 67.5,
# Swainson's thrush
species == 'ustulatus' ~ 34,
# Varied thrush
species == 'naevius' ~ 82.5,
# American robin
species == 'migratorius' ~ 77,
TRUE ~ 0))
# Assign each mammal to a size group.
items <- items %>% mutate(group=case_when(
# Snowshoe hare
species == 'americanus' ~ 'Large mammal',
# Rat sp.
genus == 'Rattus' ~ 'Medium mammal',
# Bushy-tailed woodrat
species == 'cinerea' ~ 'Medium mammal',
# Northern flying squirrel
species == 'sabrinus' ~ 'Small mammal',
# Chipmunk
genus == 'Neotamias' ~ 'Small mammal',
# Douglas & red squirrels
genus == 'Tamiasciurus' ~ 'Medium mammal',
# Bat
genus == 'Myotis' ~ 'Small mammal',
# Unknown small mammal
class == 'Mammalia' & species == 'unknown' & size == 'Small' ~ 'Small mammal',
# Unknown medium mammal
class == 'Mammalia' & species == 'unknown' & size == 'Medium' ~ 'Medium mammal',
# Unknown large mammal
class == 'Mammalia' & species == 'unknown' & size == 'Large' ~ 'Large mammal',
TRUE ~ group))
# Add common name for mammals not IDed to species.
items <- items %>% mutate(common=case_when(
class == 'Mammalia' & species == 'unknown' & size == 'Small' ~ 'average small mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Medium' ~ 'average medium mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Large' ~ 'average large mammal',
TRUE ~ common))
# Fil in mass for known mammal species.
items <- items %>% mutate(mass=case_when(
# Snowshoe hare
species == 'americanus' ~ 1340,
# Rat
genus == 'Rattus' ~ 269.8,
# Bush-tailed woodrat
species == 'cinerea' ~ 374.7,
# Northern flying-squirrel
species == 'sabrinus' ~ 155.5,
# Chipmunk
genus == 'Neotamias' ~ 66.4,
# Red squirrel
species == 'hudsonicus' ~ 224.5,
# Douglas squirrel
species == 'douglasii' ~ 203.5,
# Unknown tree squirrel
genus == 'Tamiasciurus' & species == 'sp' ~ 214,
# Bat
genus == 'Myotis' ~ 5.8,
TRUE ~ mass))
# Assign a group for items of unknown class.
items <- items %>% mutate(group=case_when(
class == 'Unknown' & size == 'Medium' ~ 'Medium item',
class == 'Unknown' & size == 'Small' ~ 'Small item',
TRUE ~ group))
# Add a common name for items of unknown class.
items <- items %>% mutate(common=case_when(
class == 'Unknown' & size == 'Medium' ~ 'average medium item',
class == 'Unknown' & size == 'Small' ~ 'average small item',
TRUE ~ common))
# Calculate the mean mass of each class/size.
m.mass <- items %>% filter(mass != 0) %>%
group_by(group) %>%
summarise(mean=mean(mass))
# Add to the list of prey items.
items <- left_join(items, m.mass, by='group') %>%
mutate(mass = ifelse(mass > 1, mass, mean)) %>%
dplyr::select(-mean)
# Calculate average small item.
sm <- items %>% filter(group %in% c('Small mammal', 'Small bird')) %>%
distinct(mass) %>%
summarize(mean(mass))
# Calculate average medium item.
md <- items %>% filter(group %in% c('Medium mammal', 'Medium bird')) %>%
distinct(mass) %>%
summarize(mean(mass))
# Insert into table.
items <- items %>% mutate(mass=replace(mass, group=='Small item', sm),
mass=replace(mass, group=='Medium item', md))
View(items)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
knitr::read_chunk('../src/prey_attributes.R')
knitr::read_chunk('../src/prey_attributes.R')
read_chunk('../src/prey_attributes.R')
<<what_sp>>
<<what_sp>>
knitr::read_chunk('../src/prey_attributes.R')
knitr::read_chunk('../src/prey_attributes.R')
knitr::read_chunk('../src/prey_attributes.R')
knitr::read_chunk('../src/prey_attributes.R')
knitr::read_chunk('../src/prey_attributes.R')
# Load some libraries.
library('tidyverse')
# Find all the files.
files <- list.files('../data/raw', pattern='photos*', full.names=TRUE)
# Check how they should be imported.
files %>% map(~spec_csv(.))
df <- list.files('../data/raw', pattern='photos*', full.names=TRUE) %>%
map_df(~read_csv(., col_types=cols(
filename = col_character(),
datetime = col_character(),
serial = col_character(),
site = col_character(),
interest = col_character(),
live.chicks = col_integer(),
class = col_character(),
order = col_character(),
family = col_character(),
genus = col_character(),
species = col_character(),
common = col_character(),
size = col_character(),
comments = col_character(),
sex = col_character()
)))
str(df)
distinct(df, interest)
distinct(df, class)
distinct(df, order)
distinct(df, family)
distinct(df, genus)
distinct(df, species)
distinct(df, common)
distinct(df, size)
# Fix genus.
df <- df %>%
mutate(genus = replace(genus, genus=='Tamasciurus', 'Tamiasciurus')) %>%
mutate(genus = replace(genus, genus=='U', 'Unknown'))
# Fix family.
df <- df %>%
mutate(family = replace(family, family=='Sciruidae', 'Sciuridae')) %>%
mutate(family = replace(family, family=='U', 'Unknown'))
# Let's do order, too.
df <- df %>%
mutate(order = replace(order, order=='U', 'Unknown'))
# Also class.
df <- df %>%
mutate(class = replace(class, class=='U', 'Unknown'))
# Make sizes prettier.
df <- df %>% mutate(size=
case_when(size == 'S' ~ 'Small',
size == 'M' ~ 'Medium',
size == 'L' ~ 'Large',
size == 'U' ~ 'Unknown',
TRUE ~ NA_character_))
# Species names.
df <- df %>% mutate(species=
case_when(species == 'spp' ~ 'sp',
species == 'U' ~ 'unknown',
TRUE ~ species))
# And finally common names.
df <- df %>% mutate(common=
case_when(common == 'American.robin' ~ 'American robin',
common == 'american.robin' ~ 'American robin',
common == 'Swainsons.thrush' ~ 'Swainson\'s thrush',
common == 'swainsons.thrush' ~ 'Swainson\'s thrush',
common == 'varied.thrush' ~ 'varied thrush',
common == 'Varied.thrush' ~ 'varied thrush',
common == 'stellers.jay' ~ 'Steller\'s jay',
common == 'gray.jay' ~ 'gray jay',
common == 'band-tailed.pigeon' ~ 'band-tailed pigeon',
common == 'bad-tailed.pigeon' ~ 'band-tailed pigeon',
common == 'U' ~ 'unknown',
common == 'Unknown' ~ 'unknown',
common == 'Douglas.squirrel' ~ 'Douglas squirrel',
common == 'douglas.squirrel' ~ 'Douglas squirrel',
common == 'bushy-tailed.woodrat' ~ 'bushy-tailed woodrat',
common == 'chimpunk' ~ 'chipmunk',
common == 'sooty.grouse' ~ 'sooty grouse',
common == 'ruffed.grouse' ~ 'ruffed grouse',
common == 'northern.flying.squirrel' ~ 'flying squirrel',
common == 'Rat' ~ 'rat',
common == 'red.squirrel' ~ 'red squirrel',
common == 'snowshoe.hare' ~ 'snowshoe hare',
TRUE ~ common))
# Filter out only observations of prey.
prey <- df %>% filter(!is.na(class))
# Check if any are missing size values.
prey %>% filter(is.na(size))
# Make the correction.
df$size[df$genus=='Lepus'] <- 'Large'
# And check.
df %>% filter(!is.na(class)) %>%
filter(is.na(size))
# Number of prey deliveried to nest.
df %>% filter(interest %in% c('newprey', 'delivery')) %>%
summarize(n())
# Number of prey identified.
df %>% filter(!is.na(class)) %>%
summarize(n())
write.csv(df, '../data/interim/camera_data.csv')
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
knitr::read_chunk('../src/prey_attributes.R')
<<what_sp>>
knitr::read_chunk('../src/prey_attributes.R')
<<what_sp>>
knitr::read_chunk('../src/prey_attributes.R')
file.exists('../src/prey_attributes.R')
knitr::read_chunk('../src/prey_attributes.R')
