BCLCS_LV_1 == 'V' & BCLCS_LV_4 == TC ~ 4,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == TC ~ 4,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == 'TC' ~ 5,
TRUE ~ 0
))
vri.class
vri.class %>% group_by(class) %>% summarise(n())
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 < 10 ~ 5,
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 10 & < 30 ~ 6,
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 30 & < 100 ~ 7,
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 < 10 ~ 5,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 10 & < 30 ~ 6,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 30 & < 100 ~ 7,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == 'TC' ~ 5
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 < 10 ~ 5,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 10 & < 30 ~ 6,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 30 & < 100 ~ 7,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == 'TC' ~ 5,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 < 10 ~ 5,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 10 & < 30 ~ 6,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 30 & < 100 ~ 7,
#BCLCS_LV_4 == 'TC' ~ 5 & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 == 'TC' ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 10 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 10 & PROJ_AGE_1 < 30 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 30 & PROJ_AGE_1 < 100 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 100 ~ 8,
TRUE ~ 0
))
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TD', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
# See how it turned out.
vri.class %>% group_by(class) %>% summarise(n())
# What are all these things classed as 0s?
vri.class %>% filter(class == 0) %>%
group_by(BCLCS_LV_1, BCLCS_LV_4) %>%
summarize(n())
vri.class %>% filter(class == 0) %>%
group_by(BCLCS_LV_1, BCLCS_LV_4) %>%
summarize(n())
# Assign to classes.
# Regen/young/mature/old ages come from Zharikov et al. 2007
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TB', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
vri.class %>% filter(class == 0 & BCLCS_LV_4 == 'TC') %>%
dplyr::select(PROJ_AGE_1)
# See how it turned out.
vri.class %>% group_by(class) %>% summarise(n())
# See how it turned out.
vri.class %>% group_by(class) %>% summarise(n())
# Set raster extent based on tz shapefile.
ext <- extent(vri)
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sq=amount.sq/total) %>%
dplyr::select(site, prop.sq) %>% distinct()
sq.mass
# Import transition zone shapefile.
vri <- st_read('../data/external/VRI_camera-sites_2019.shp')
# Look at it.
ggplot() +
geom_sf(data=vri) +
theme_classic()
# Assign to classes.
# Regen/young/mature/old ages come from Zharikov et al. 2007
vri.class <- vri %>% mutate(class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TB', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
# See how it turned out.
vri.class %>% group_by(class) %>% summarise(n())
# Set raster extent based on tz shapefile.
ext <- extent(vri)
# Make an empty raster to populate with values.
r <- raster(ext, res=c(100, 100))
# Populate BEC polygon data onto empty raster grid.
r.vri <- rasterize(vri, r, 'class')
# Populate BEC polygon data onto empty raster grid.
r.vri <- rasterize(vri, r, class)
vri.class$class %>% head()
5+6
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sq=amount.sq/total) %>%
dplyr::select(site, prop.sq) %>% distinct()
sq.mass
# Import transition zone shapefile.
vri <- st_read('../data/external/VRI_camera-sites_2019.shp')
# Look at it.
ggplot() +
geom_sf(data=vri) +
theme_classic()
# Assign to classes.
# Regen/young/mature/old ages come from Zharikov et al. 2007
vri.class <- vri %>% mutate(hab.class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TB', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
# See how it turned out.
vri.class %>% group_by(hab.class) %>% summarise(n())
# Set raster extent based on tz shapefile.
ext <- extent(vri)
# Make an empty raster to populate with values.
r <- raster(ext, res=c(100, 100))
vri.class$hab.class %>% head()
vri.class$hab.class %>% class()
class(vri.class)
r.vri <- rasterize(vri, r, 'hab.class')
r.vri <- rasterize(vri.class, r, 'hab.class')
dataframe(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested',
'deciduous', 'regen', 'young', 'mature', 'old'))
tibble(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested',
'deciduous', 'regen', 'young', 'mature', 'old'))
data.frame(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested',
'deciduous', 'regen', 'young', 'mature', 'old'))
# Create labels for raster.
levels <- data.frame(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested', 'deciduous', 'regen', 'young', 'mature', 'old'))
# Create labels for raster.
vri. levels <- data.frame(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested', 'deciduous', 'regen', 'young', 'mature', 'old'))
# Create labels for raster.
vri.levels <- data.frame(id=0:8, class.name=c('undefined', 'water', 'land', 'unforested', 'deciduous', 'regen', 'young', 'mature', 'old'))
# Add them to the raster.
levels(r.vri) <- vri.levels
# Create labels for raster.
vri.levels <- data.frame(ID=0:8, class.name=c('undefined', 'water', 'land', 'unforested', 'deciduous', 'regen', 'young', 'mature', 'old'))
# Add them to the raster.
levels(r.vri) <- vri.levels
# Save the raster image.
writeRaster(r.vri, '../data/interim/vri_camera-sites_2019.tif', format='GTiff')
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
# I had some trouble with readr so I increased the number of rows used to guess.
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sq=amount.sq/total) %>%
dplyr::select(site, prop.sq) %>% distinct()
sq.mass
# Import transition zone shapefile.
vri <- st_read('../data/external/VRI_camera-sites_2019.shp')
# Assign to classes.
# Regen/young/mature/old ages come from Zharikov et al. 2007
vri.class <- vri %>% mutate(hab.class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TB', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
# See how it turned out.
vri.class %>% group_by(hab.class) %>% summarise(n())
4+5
# Import the raster.
r.vri <- raster('../data/interim/vri_camera-sites_2019.tif')
# Import nests and calculate centroids.
sites <- read_csv('../data/processed/the_big_list_of_nests.csv') %>%
group_by(name) %>%
mutate_at(c('lat', 'lon'), mean) %>%
mutate_at(vars(starts_with('status')), max) %>%
mutate_at(c('telemetry', 'cameras', 'remains'), max) %>%
dplyr::select(-nest, -NOTES) %>%
distinct() %>%
filter(cameras > 0)
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load some libraries.
library(tidyverse)
library(landscapemetrics)
library(raster)
library(sf)
# Bring in diet data.
df <- read_csv('../data/interim/camera_corrected.csv', guess_max=7000)
source('../src/prey_attributes.R')
head(items)
# Calculate proportion of diet made up of squirrel at each site.
sq.mass <- items %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(amount.sq=sum(mass), prop.sq=amount.sq/total) %>%
dplyr::select(site, prop.sq) %>% distinct()
sq.mass
# Import transition zone shapefile.
vri <- st_read('../data/external/VRI_camera-sites_2019.shp')
# Assign to classes.
# Regen/young/mature/old ages come from Zharikov et al. 2007
vri.class <- vri %>% mutate(hab.class=case_when(
# Non-vegetated and water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 == 'W' ~ 1,
# Non-vegetated and not water
BCLCS_LV_1 == 'N' & BCLCS_LV_2 != 'W' ~ 2,
# Vegetated and not trees
BCLCS_LV_1 == 'V' & BCLCS_LV_2 == 'N' ~ 3,
# Vegetated and mixed or deciduous trees
BCLCS_LV_1 == 'V' & BCLCS_LV_4 %in% c('TB', 'TM') ~ 4,
# Vegetated and coniferous trees
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 < 20 ~ 5,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 20 & PROJ_AGE_1 < 60 ~ 6,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 60 & PROJ_AGE_1 < 140 ~ 7,
BCLCS_LV_4 == 'TC' & PROJ_AGE_1 >= 140 ~ 8,
TRUE ~ 0
))
# See how it turned out.
vri.class %>% group_by(hab.class) %>% summarise(n())
# Import the raster.
r.vri <- raster('../data/interim/vri_camera-sites_2019.tif')
# Import nests and calculate centroids.
sites <- read_csv('../data/processed/the_big_list_of_nests.csv') %>%
group_by(name) %>%
mutate_at(c('lat', 'lon'), mean) %>%
mutate_at(vars(starts_with('status')), max) %>%
mutate_at(c('telemetry', 'cameras', 'remains'), max) %>%
dplyr::select(-nest, -NOTES) %>%
distinct() %>%
filter(cameras > 0)
# Make site table a spatial object and make it UTMs.
sites.sf <- st_as_sf(sites, coords=c('lon', 'lat')) %>%
st_set_crs('+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs') %>%
st_transform("+proj=utm +zone=10 +datum=WGS84 +units=m +no_defs")
# Make site table a spatial object and make it UTMs.
sites.sf <- ungroup(sites) st_as_sf(sites, coords=c('lon', 'lat')) %>%
# Make site table a spatial object and make it UTMs.
sites.sf <- ungroup(sites) %>% st_as_sf(coords=c('lon', 'lat')) %>%
st_set_crs('+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs') %>%
st_transform("+proj=utm +zone=10 +datum=WGS84 +units=m +no_defs")
# Convert approximate homerange area in ha to radius in m
a.hr.ha <- 3700
r.hr.m <- sqrt(a.hr.ha*10000/pi)
# Calculate area per class per site.
class.area <- sample_lsm(r.vri, y=sites.sf, size=r.hr.m, what='lsm_c_ca',
shape='circle') #%>%
check_landscape(r.vri)
check_landscape(r.vri)
# Convert approximate homerange area in ha to radius in m
a.hr.ha <- 3000
r.hr.m <- sqrt(a.hr.ha*10000/pi)
# Calculate area per class per site.
class.area <- sample_lsm(r.vri, y=sites.sf, size=r.hr.m, what='lsm_c_ca',
shape='circle') #%>%
# Convert approximate homerange area in ha to radius in m
a.hr.ha <- 300
r.hr.m <- sqrt(a.hr.ha*10000/pi)
# Calculate area per class per site.
class.area <- sample_lsm(r.vri, y=sites.sf, size=r.hr.m, what='lsm_c_ca',
shape='circle') #%>%
View(sites)
sites <- filter(site != 'TCR') %>%
ungroup()
sites <- filter(sites != 'TCR') %>%
ungroup()
# Import nests and calculate centroids.
sites <- read_csv('../data/processed/the_big_list_of_nests.csv') %>%
group_by(name) %>%
mutate_at(c('lat', 'lon'), mean) %>%
mutate_at(vars(starts_with('status')), max) %>%
mutate_at(c('telemetry', 'cameras', 'remains'), max) %>%
dplyr::select(-nest, -NOTES) %>%
distinct() %>%
filter(cameras > 0)
# Drop TCR, ungroup.
sites <- filter(sites != 'TCR') %>%
ungroup()
class(sites)
# Drop TCR, ungroup.
sites <- dplyr::filter(sites != 'TCR') %>%
ungroup()
# Drop TCR, ungroup.
sites <- sites %>% filter(site != 'TCR') %>%
ungroup()
# Make site table a spatial object and make it UTMs.
sites.sf <- ungroup(sites) %>% st_as_sf(coords=c('lon', 'lat')) %>%
st_set_crs('+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs') %>%
st_transform("+proj=utm +zone=10 +datum=WGS84 +units=m +no_defs")
# Convert approximate homerange area in ha to radius in m
a.hr.ha <- 3700
r.hr.m <- sqrt(a.hr.ha*10000/pi)
# Calculate area per class per site.
class.area <- sample_lsm(r.vri, y=sites.sf, size=r.hr.m, what='lsm_c_ca',
shape='circle') #%>%
class.area
# Calculate area per class per site.
class.area <- sample_lsm(r.vri, y=sites.sf, size=r.hr.m, what='lsm_c_ca',
shape='circle') %>%
# Amend class number with habitat class name.
left_join(data.frame(levels(r.vri)), by=c('class'='ID')) #%>%
class.area
# Calculate area per class per site.
class.area <- sample_lsm(r.vri, y=sites.sf, size=r.hr.m, what='lsm_c_ca',
shape='circle') %>%
# Amend class number with habitat class name.
left_join(data.frame(levels(r.vri)), by=c('class'='ID')) %>%
# Reorganize by site.
pivot_wider(id_cols=plot_id, names_from=map_label, values_from=value,
values_fill=list(value=0))
# Calculate area per class per site.
class.area <- sample_lsm(r.vri, y=sites.sf, size=r.hr.m, what='lsm_c_ca',
shape='circle') %>%
# Amend class number with habitat class name.
left_join(data.frame(levels(r.vri)), by=c('class'='ID')) %>%
# Reorganize by site.
pivot_wider(id_cols=plot_id, names_from=category, values_from=value,
values_fill=list(value=0))
class.area
plot(r.vri)
show_patches(r.vri)
st_buffer(sites.sf, r.hr.m)
st_buffer(sites.sf, r.hr.m) %>% plot()
buffers <- st_buffer(sites.sf, r.hr.m)
st_crop(r.vri, buffers)
crop(r.vri, buffers)
crop(r.vri, buffers) %>% plot()
buffers$site %>% plot()
show_landscape(r.vri)
show_landscape(r.vri)
install.packages("landscapetools")
library(landscapetools)
?show_shareplot()
show_landscape(r.vri)
show_landscape(r.vri, discrete=TRUE)
class(sites.sf)
show_shareplot(r.vri, sites.sf, 10, 50)
show_shareplot(r.vri, sites.sf, 10, 50)
show_shareplot(r.vri, sites.sf, 10, 50)
show_shareplot(classified_landscape, new_point, 10, 50)
devtools::install_github("ropensci/landscapetools")
install.packages('devtools')
devtools::install_github("ropensci/landscapetools")
devtools::install_github("ropensci/landscapetools")
devtools::install_github("ropensci/landscapetools")
