as.numeric(n)
cameras %>% group_by(n_fledge) %>%
summarize(n=n()) %>%
filter(n_fledge==3) %>%
dplyr::select(n) %>%
as.numeric(n)
n.fledge <- cameras %>% group_by(n_fledge) %>%
summarize(n=n())
View(n.fledge)
n.fledge[2,2]
n.fledge[3,2]
n.fledge[3,]
n.fledge[3, 2]
View(cameras)
nrows(df)
nrow(df)
df %>% filter(interest %in% c('newprey', 'delivery'))
df %>% filter(interest %in% c('newprey', 'delivery')) %>% nrow()
df %>% filter(class != 'Unknown') %>% nrow()
df %>% mutate(total=nrow())
df %>% mutate(total=nrow()) %>%
mutate(total=n()) %>%
filter(class != 'Unknown')
df %>% mutate(total=n()) %>%
filter(class != 'Unknown')
df %>% filter(interest %in% c('newprey', 'delivery')) %>%
mutate(total=n()) %>%
filter(class != 'Unknown') %>%
mutate(IDd=n(), prop=IDd/total)
df %>% filter(interest %in% c('newprey', 'delivery')) %>%
mutate(total=n()) %>%
filter(class != 'Unknown') %>%
mutate(IDd=n(), prop=IDd/total*100)
# Import prey items data
source('../src/prey_attributes.R')
# Filter out just the prey items delivered.
# Remove complete unknowns (ie, no class or size).
items <- df %>% filter(class != '') %>%
filter(size != 'Unknown') %>%
dplyr::select(site, class, family, genus, species, common, size) %>%
arrange(class, family, genus, species, size)
# Classify each avian item into a size class.
items <- items %>% mutate(group=case_when(
# Band-tailed pigeon
species == 'fasciata' ~ 'Large bird',
# Ruffed grouse
species == 'umbellus' ~ 'Large bird',
# Sooty grouse
species == 'fulignosus' ~ 'Large bird',
# Steller's jay
species == 'stelleri' ~ 'Medium bird',
# Gray jay
species == 'canadensis' ~ 'Medium bird',
# Swainson's thrush
species == 'ustulatus' ~ 'Small bird',
# Varied thrush
species == 'naevius' ~ 'Medium bird',
# American robin
species == 'migratorius' ~ 'Medium bird',
# Unknown small bird
class == 'Aves' & species == 'unknown' & size == 'Small' ~ 'Small bird',
# Unknown medium bird
class == 'Aves' & species == 'unknown' & size == 'Medium' ~ 'Medium bird',
# Unknown large bird
class == 'Aves' & species == 'unknown' & size == 'Large' ~ 'Large bird',
TRUE ~ 'group'))
# Add a common name for items not IDed to species.
items <- items %>% mutate(common=case_when(
class == 'Aves' & species == 'unknown' & size == 'Small' ~ 'average small bird',
class == 'Aves' & species == 'unknown' & size == 'Medium' ~ 'average medium bird',
class == 'Aves' & species == 'unknown' & size == 'Large' ~ 'average large bird',
TRUE ~ common))
# Fil in mass for known bird species.
items <- items %>% mutate(mass=case_when(
# Band-tailed pigeon (# from S. BC)
species == 'fasciata' ~ 379.4,
# Ruffed grouse (# from Alberta)
species == 'umbellus' ~ 523.4,
# Sooty grouse (from Vancouver & Harwicke Islands)
species == 'fulignosus' ~ 1055.5,
# Steller's jay (W. Canada)
species == 'stelleri' ~ 128,
# Gray jay (P. c. pacificus, Alaska)
species == 'canadensis' ~ 70.2
# Swainson's thrush (Idaho)
species == 'ustulatus' ~ 29.8,
# Varied thrush ("breeding grounds")
species == 'naevius' ~ 79.35,
# American robin
species == 'migratorius' ~ 79.9,
TRUE ~ 0))
# Fil in mass for known bird species.
items <- items %>% mutate(mass=case_when(
# Band-tailed pigeon (# from S. BC)
species == 'fasciata' ~ 379.4,
# Ruffed grouse (# from Alberta)
species == 'umbellus' ~ 523.4,
# Sooty grouse (from Vancouver & Harwicke Islands)
species == 'fulignosus' ~ 1055.5,
# Steller's jay (W. Canada)
species == 'stelleri' ~ 128,
# Gray jay (P. c. pacificus, Alaska)
species == 'canadensis' ~ 70.2,
# Swainson's thrush (Idaho)
species == 'ustulatus' ~ 29.8,
# Varied thrush ("breeding grounds")
species == 'naevius' ~ 79.35,
# American robin
species == 'migratorius' ~ 79.9,
TRUE ~ 0))
# Assign each mammal to a size group.
items <- items %>% mutate(group=case_when(
# Snowshoe hare
species == 'americanus' ~ 'Large mammal',
# Rat sp.
genus == 'Rattus' ~ 'Medium mammal',
# Bushy-tailed woodrat
species == 'cinerea' ~ 'Medium mammal',
# Northern flying squirrel
species == 'sabrinus' ~ 'Small mammal',
# Chipmunk
genus == 'Neotamias' ~ 'Small mammal',
# Douglas & red squirrels
genus == 'Tamiasciurus' ~ 'Medium mammal',
# Bat
genus == 'Myotis' ~ 'Small mammal',
# Unknown small mammal
class == 'Mammalia' & species == 'unknown' & size == 'Small' ~ 'Small mammal',
# Unknown medium mammal
class == 'Mammalia' & species == 'unknown' & size == 'Medium' ~ 'Medium mammal',
# Unknown large mammal
class == 'Mammalia' & species == 'unknown' & size == 'Large' ~ 'Large mammal',
TRUE ~ group))
# Add common name for mammals not IDed to species.
items <- items %>% mutate(common=case_when(
class == 'Mammalia' & species == 'unknown' & size == 'Small' ~ 'average small mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Medium' ~ 'average medium mammal',
class == 'Mammalia' & species == 'unknown' & size == 'Large' ~ 'average large mammal',
TRUE ~ common))
# Fil in mass for known mammal species.
items <- items %>% mutate(mass=case_when(
# Snowshoe hare
species == 'americanus' ~ 1340,
# Rat
genus == 'Rattus' ~ 269.8,
# Bush-tailed woodrat
species == 'cinerea' ~ 374.7,
# Northern flying-squirrel
species == 'sabrinus' ~ 155.5,
# Chipmunk
genus == 'Neotamias' ~ 66.4,
# Red squirrel
species == 'hudsonicus' ~ 224.5,
# Douglas squirrel
species == 'douglasii' ~ 203.5,
# Unknown tree squirrel
genus == 'Tamiasciurus' & species == 'sp' ~ 214,
# Bat
genus == 'Myotis' ~ 5.8,
TRUE ~ mass))
# Assign a group for items of unknown class.
items <- items %>% mutate(group=case_when(
class == 'Unknown' & size == 'Medium' ~ 'Medium item',
class == 'Unknown' & size == 'Small' ~ 'Small item',
TRUE ~ group))
# Add a common name for items of unknown class.
items <- items %>% mutate(common=case_when(
class == 'Unknown' & size == 'Medium' ~ 'average medium item',
class == 'Unknown' & size == 'Small' ~ 'average small item',
TRUE ~ common))
# Calculate the mean mass of each class/size.
m.mass <- items %>% filter(mass != 0) %>%
group_by(group) %>%
summarise(mean=mean(mass))
# Add to the list of prey items.
items <- left_join(items, m.mass, by='group') %>%
mutate(mass = ifelse(mass > 1, mass, mean)) %>%
dplyr::select(-mean)
# Calculate average small item.
sm <- items %>% filter(group %in% c('Small mammal', 'Small bird')) %>%
distinct(mass) %>%
summarize(mean(mass))
# Calculate average medium item.
md <- items %>% filter(group %in% c('Medium mammal', 'Medium bird')) %>%
distinct(mass) %>%
summarize(mean(mass))
# Insert into table.
items <- items %>% mutate(mass=replace(mass, group=='Small item', sm),
mass=replace(mass, group=='Medium item', md))
df %>% filter(interest %in% c('newprey', 'delivery')) %>% nrow()
nrow(items)
# How many deliveries?
n.del <- df %>% filter(interest %in% c('newprey', 'delivery')) %>% nrow()
items %>% filter(class != 'Unknown') %>% nrow()
n.to.class <- items %>% filter(class != 'Unknown') %>% nrow()
# How many idetnified to genus?
n.to.genus <- items %>% filter(genus != 'Unknown') %>% nrow()
n.to.class/n.del
n.to.class/n.del*100
round(n.to.class/n.del*100, digits=2)
round(n.to.class/n.del*100, digits=0)
nrow(items)
nrow(n.del)
n.del
as.numeric(n.del)
n.del-nrow(items)
n.del-nrow(items)/n.del
(n.del-nrow(items))/n.del
(n.del-nrow(items))/n.del*100
items %>% filter(genus != 'Unknown') %>%
distinct()
items %>% filter(genus != 'Unknown') %>%
group_by(genus, species) %>%
distinct()
items %>% filter(genus != 'Unknown') %>%
dplyr::select(genus, species) %>%
distinct()
items %>% filter(genus != 'Unknown') %>%
dplyr::select(genus, species) %>%
distinct() %>%
summarize(n())
View(items)
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass))
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass))
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(class == 'Mammalia') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(s.mass=sum(mass), p.mass.s=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(m.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(j.mass=sum(mass), p.mass.m=(m.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(sp.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(sq.mass/t.mass)*100) %>%
dplyr::select(p.mass.m) %>% distinct() %>% as.numeric() %>%
round()
items %>% mutate(mass=as.numeric(mass), t.mass=sum(mass)) %>%
filter(genus == 'Tamiasciurus') %>%
mutate(sq.mass=sum(mass), p.mass.sq=(sq.mass/t.mass)*100) %>%
dplyr::select(p.mass.sq) %>% distinct() %>% as.numeric() %>%
round()
45+17+14
69+17+14
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
n.nests <- df %>% distinct(site) %>% summarize(n()) %>% as.numeric()
install.date <- df %>% group_by(site) %>% summarize(d=min(datetime)) %>%
mutate(day=day(d), m=month(d))
# Import prey items data
source('../src/prey_attributes.R')
# Import basic camera nest data
cameras <- read.csv('../data/raw/productivity_2019.csv', stringsAsFactors=FALSE)
# Do the date conversion thing.
cameras <- cameras %>% mutate(date=ymd(date), branch=ymd(branch), fledge=ymd(fledge))
# How many fledged?
n.fledge <- cameras %>% group_by(n_fledge) %>%
summarize(n=n())
# How many deliveries?
n.del <- df %>% filter(interest %in% c('newprey', 'delivery')) %>% nrow()
# How many identified to class?
n.to.class <- items %>% filter(class != 'Unknown') %>% nrow()
# How many idetnified to genus?
n.to.genus <- items %>% filter(genus != 'Unknown') %>% nrow()
del.per.day <- df %>% filter(interest %in% c('delivery', 'newprey')) %>%
mutate(day=date(datetime)) %>%
group_by(site) %>%
mutate(first=min(day), last=max(day), n.day=last-first) %>%
add_count(site, day, name='n.del') %>%
add_count(site, name='t.del') %>%
mutate(n.day=as.numeric(n.day), per.day=t.del/n.day) %>%
dplyr::select(site, day, n.day, n.del, t.del) %>%
distinct() %>%
complete(nesting(site), day=seq(min(day), max(day), by='day')) %>%
fill(n.day, t.del) %>%
mutate(n.del=replace_na(n.del, 0))
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
source('../src/prey_attributes.R')
del.per.day <- df %>% filter(interest %in% c('delivery', 'newprey')) %>%
mutate(day=date(datetime)) %>%
group_by(site) %>%
mutate(first=min(day), last=max(day), n.day=last-first) %>%
add_count(site, day, name='n.del') %>%
add_count(site, name='t.del') %>%
mutate(n.day=as.numeric(n.day), per.day=t.del/n.day) %>%
dplyr::select(site, day, n.day, n.del, t.del) %>%
distinct() %>%
complete(nesting(site), day=seq(min(day), max(day), by='day')) %>%
fill(n.day, t.del) %>%
mutate(n.del=replace_na(n.del, 0))
del.per.day %>% group_by(site) %>%
summarize(mean=mean(n.del))
del.per.day %>% group_by(site) %>%
summarize(mean=mean(n.del)) %>%
summarize(mean(mean), sd(mean))
mass.per.site <- items %>% group_by(site) %>%
mutate(mass=as.numeric(mass)) %>%
summarize(t.mass=sum(mass))
del.per.day %>% dplyr::select(site, n.day) %>%
distinct() %>%
right_join(mass.per.site) %>%
mutate(d.mass=t.mass/n.day)
del.per.day %>% dplyr::select(site, n.day) %>%
distinct() %>%
right_join(mass.per.site) %>%
mutate(d.mass=t.mass/n.day) %>%
summarize(mean(d.mass), sd(d.mass))
del.per.day %>% dplyr::select(site, n.day) %>%
distinct() %>%
right_join(mass.per.site) %>%
mutate(d.mass=t.mass/n.day) %>%
summarize(mean=mean(d.mass), sd(mean))
del.per.day %>% dplyr::select(site, n.day) %>%
distinct() %>%
right_join(mass.per.site) %>%
mutate(d.mass=t.mass/n.day) %>%
summarize(mean=mean(d.mass))
View(mass.per.site)
mass.per.site <- items %>% group_by(site) %>%
mutate(mass=as.numeric(mass)) %>%
summarize(t.mass=sum(mass))
mass.per.day <- del.per.day %>% dplyr::select(site, n.day) %>%
distinct() %>%
right_join(mass.per.site) %>%
mutate(d.mass=t.mass/n.day)
mass.per.day
mass.per.day
mass.per.day %>% summarize(mean=mean(d.mass))
mass.per.day %>% ungroup() %>%
summarize(mean=mean(d.mass))
mass.per.day %>% ungroup() %>%
summarize(mean(d.mass), sd(d.mass))
mass.per.day %>% ungroup() %>%
summarize(mean(d.mass), sd(d.mass))
mass.per.day
sd(mass.per.day$d.mass)
View(df)
source('../src/prey_attributes_date.R')
View(items)
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass))
View(mass.by.day)
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
distinct
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
distinct() %>%
complete(nesting(site), day=seq(min(date), max(date), by='day'))
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
distinct() %>%
complete(nesting(site), date=seq(min(date), max(date), by='day'))
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
distinct()# %>%
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
distinct() %>%
complete(nesting(site), date=seq(min(date), max(date), by='day'))
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
distinct()# %>%
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) #%>%
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) #%>%
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
arrange(site, date)
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
arrange(site, date)
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
arrange(site, date) %>%
distinct()# %>%
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
arrange(site, date) %>%
distinct() %>%
ungroup() %>%
complete(nesting(site), date=seq(min(date), max(date), by='day'))
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
arrange(site, date) %>%
distinct() %>%
ungroup() %>% group_by(site)
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
arrange(site, date) %>%
distinct() %>%
ungroup() %>% group_by(site) %>%
complete(nesting(site), date=seq(min(date), max(date), by='day'))
mass.by.day <- items %>% mutate(date=date(datetime), mass=as.numeric(mass)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
arrange(site, date) %>%
distinct() %>%
ungroup() %>% group_by(site) %>%
complete(nesting(site), date=seq(min(date), max(date), by='day')) %>%
mutate(d.mass=replace_na(d.mass, 0))
del.per.day %>% group_by(site) %>%
summarize(mean=mean(n.del))
mass.by.day %>% group_by(site) %>%
summarize(mean=mean(n.del))
mass.by.day %>% group_by(site) %>%
summarize(mean=mean(d.mass))
mass.by.day %>% group_by(site) %>%
summarize(mean=mean(d.mass)) %>%
summarize(mean(mean), sd(mean))
