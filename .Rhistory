kable_styling() %>%
add_header_above(c(" " = 1, "Group 1" = 2, "Group 2" = 2, "Group 3" = 2))
kable(dt, 'latex', booktabs=T) %>%
kable_styling() %>%
add_header_above(c(" " = 1, "Group 1" = 2, "Group 2" = 2, "Group 3" = 2))
kable(dt, 'latex', booktabs=T) %>%
kable_styling() %>%
add_header_above(c(" " = 3, "Group 1" = 2, "Group 2" = 2, "Group 3" = 2))
kable(dt, 'latex', booktabs=T) %>%
kable_styling() %>%
add_header_above(c(" " = 3, "Group 1" = 2, "Group 2" = 2, "Group 3" = 2, "Group 4" = 2))
dt <- read.csv('../data/raw/total_data_summary.csv', stringsAsFactors=FALSE) %>%
replace(is.na(.), ' ')
kable(dt, 'latex', booktabs=T, col.names=
c('Site', 'Name', 'Type', 'Date', 'N', 'Date', 'N', 'Date', 'N', 'Date', 'Comments')) %>%
kableExtra::landscape() %>%
kable_styling() %>%
add_header_above(c(' '=3, 'Physical remains'=2, 'Cameras'=2, 'Telemetry'=2, 'Occupancy'=1, ' '=1))
kable(dt, 'latex', booktabs=T, col.names=
c('Site', 'Name', 'Type', 'Date', 'N', 'Date', 'N', 'Date', 'N', 'Date', 'Comments')) %>%
landscape(margin = c('1cm')) %>%
kable_styling() %>%
add_header_above(c(' '=3, 'Physical remains'=2, 'Cameras'=2, 'Telemetry'=2, 'Occupancy'=1, ' '=1))
kable(dt, 'latex', booktabs=T, col.names=
c('Site', 'Name', 'Type', 'Date', 'N', 'Date', 'N', 'Date', 'N', 'Date', 'Comments')) %>%
kable_styling() %>%
add_header_above(c(' '=3, 'Physical remains'=2, 'Cameras'=2, 'Telemetry'=2, 'Occupancy'=1, ' '=1)) %>%
landscape(margin = c('1cm'))
kable(dt, 'latex', booktabs=T, col.names=
c('Site', 'Name', 'Type', 'Date', 'N', 'Date', 'N', 'Date', 'N', 'Date', 'Comments')) %>%
kable_styling(latex_options=c('scale_down')) %>%
add_header_above(c(' '=3, 'Physical remains'=2, 'Cameras'=2, 'Telemetry'=2, 'Occupancy'=1, ' '=1)) %>%
landscape(margin = c('1cm'))
kable(dt, 'latex', booktabs=T, caption='Summary of available sites',
col.names=
c('Site', 'Name', 'Type', 'Date', 'N', 'Date', 'N', 'Date', 'N', 'Date', 'Comments')) %>%
kable_styling(latex_options=c('scale_down')) %>%
add_header_above(c(' '=3, 'Physical remains'=2, 'Cameras'=2, 'Telemetry'=2, 'Occupancy'=1, ' '=1)) %>%
landscape(margin = c('1cm'))
dt <- read.csv('../data/raw/total_data_twisted.csv', stringsAsFactors=FALSE) %>%
replace(is.na(.), ' ')
kable(dt, 'latex', booktabs=T, caption='Summary of available data',
table.envir = "capctable",
col.names=
c('Site', 'Name', 'Int', 'Ext', 'Phys. rem.', 'Cameras', '2018 M', '2018 F', '2019 M', '2019 F', '2015', '2016', '2017', '2018')) %>%
kable_styling(latex_options=c('scale_down')) %>%
add_header_above(c(' '=2, 'Type'=2, 'Diet'=2, 'Telemetry'=4, 'Occupancy'=5)) %>%
landscape(margin = c('1cm'))
kable(dt, 'latex', booktabs=T, caption='Summary of available data',
table.envir = "capctable",
col.names=
c('Site', 'Name', 'Int', 'Ext', 'Phys. rem.', 'Cameras', '2018 M', '2018 F', '2019 M', '2019 F', '2015', '2016', '2017', '2018', '2019')) %>%
kable_styling(latex_options=c('scale_down')) %>%
add_header_above(c(' '=2, 'Type'=2, 'Diet'=2, 'Telemetry'=4, 'Occupancy'=5)) %>%
landscape(margin = c('1cm'))
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library('knitr')
library('kableExtra')
dt <- read.csv('../data/raw/total_data_twisted.csv', stringsAsFactors=FALSE) %>%
replace(is.na(.), ' ')
# kable(dt, 'latex', booktabs=T, caption='Summary of available sites',
#       table.envir = "capctable",
#       col.names=
#         c('Site', 'Name', 'Type', 'Date', 'N', 'Date', 'N', 'Date', 'N', 'Date', 'Comments')) %>%
#   kable_styling(latex_options=c('scale_down')) %>%
#   add_header_above(c(' '=3, 'Physical remains'=2, 'Cameras'=2, 'Telemetry'=2, 'Occupancy'=1, ' '=1)) %>%
#   landscape(margin = c('1cm'))
kable(dt, 'latex', booktabs=T, caption='Summary of available data',
table.envir = "capctable",
col.names=
c('Site', 'Name', 'Int', 'Ext', 'Phys. rem.', 'Cameras', '2018 M', '2018 F', '2019 M', '2019 F', '2015', '2016', '2017', '2018', '2019')) %>%
kable_styling(latex_options=c('scale_down', 'striped')) %>%
add_header_above(c(' '=2, 'Type'=2, 'Diet'=2, 'Telemetry'=4, 'Occupancy'=5)) %>%
landscape(margin = c('1cm'))
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
library('tidyverse')
library('tidyverse')
```
4+5
dt <- read.csv('../data/raw/total_data_twisted.csv', stringsAsFactors=FALSE) %>%
replace(is.na(.), ' ')
# kable(dt, 'latex', booktabs=T, caption='Summary of available sites',
#       table.envir = "capctable",
#       col.names=
#         c('Site', 'Name', 'Type', 'Date', 'N', 'Date', 'N', 'Date', 'N', 'Date', 'Comments')) %>%
#   kable_styling(latex_options=c('scale_down')) %>%
#   add_header_above(c(' '=3, 'Physical remains'=2, 'Cameras'=2, 'Telemetry'=2, 'Occupancy'=1, ' '=1)) %>%
#   landscape(margin = c('1cm'))
kable(dt, 'latex', booktabs=T, caption='Summary of available data',
table.envir = "capctable",
col.names=
c('Site', 'Name', 'Int', 'Ext', 'Phys. rem.', 'Cameras', '2018 M', '2018 F', '2019 M', '2019 F', '2015', '2016', '2017', '2018', '2019')) %>%
kable_styling(latex_options=c('scale_down', 'striped')) %>%
add_header_above(c(' '=2, 'Type'=2, 'Diet'=2, 'Telemetry'=4, 'Occupancy'=5)) %>%
landscape(margin = c('1cm'))
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
library('lubridate')
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
source('../src/prey_attributes.R')
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
source('../src/prey_attributes.R')
# Do the calculations
mass.table <- items %>% mutate(mass=as.numeric(mass)) %>%
# Calculate totall biomass & total count.
mutate(t.biomass=sum(mass), t.n=n()) %>%
group_by(common) %>%
# Calcuate biomass and count by group.
# Calculate percent biomass and count by group.
mutate(n=n(), biomass=sum(mass), p.biomass=(biomass/t.biomass*100),
p.n=(n/t.n*100))
# Make a pretty table.
prey.table <- mass.table %>% arrange(class, group, genus) %>%
unite(name, 4:5, sep=' ', remove=FALSE) %>%
mutate(name=case_when(
name == 'Unknown unknown' ~ ' ',
TRUE ~ name
)) %>%
dplyr::select(common, name, n, p.n, p.biomass) %>%
distinct()
# Print it out.
prey.table %>%
kable(col.names=(c('Prey species', '', 'Count', '% count', '% biomass')),
digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Large birds (> 150 g)', 1, 3) %>%
pack_rows('Medium birds (60-150 g)', 4, 8) %>%
pack_rows('Small birds (< 40 g)', 9, 10) %>%
pack_rows('Large mammals (> 600 g)', 11, 12) %>%
pack_rows('Medium mammals (200-600 g)', 13, 18) %>%
pack_rows('Small mammals (< 200 g)', 19, 22) %>%
pack_rows('Unidentified items', 23, 24)
# Print it out.
prey.table %>%
kable('latex', booktabs=T, caption='Summary of nest camera data',
table.envir = "capctable", col.names=(c('Prey species', '', 'Count', '% count', '% biomass')),
digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Large birds (> 150 g)', 1, 3) %>%
pack_rows('Medium birds (60-150 g)', 4, 8) %>%
pack_rows('Small birds (< 40 g)', 9, 10) %>%
pack_rows('Large mammals (> 600 g)', 11, 12) %>%
pack_rows('Medium mammals (200-600 g)', 13, 18) %>%
pack_rows('Small mammals (< 200 g)', 19, 22) %>%
pack_rows('Unidentified items', 23, 24)
# Calculate days.
timespan <- df %>% filter(interest %in% c('delivery', 'newprey')) %>% group_by(site) %>%
summarize(first=min(datetime), last=max(datetime)) %>%
mutate(first=date(first), last=date(last)) %>%
mutate(days=difftime(last, first))
n.prey <- df %>% filter(interest %in% c('delivery', 'newprey')) %>% group_by(site) %>% summarize(prey=n())
# Photos per day?
bind_cols(timespan, n.prey) %>%
mutate(days=as.numeric(days), per.day=prey/days) %>%
dplyr::select(site, first, last, prey, per.day) %>%
kable('latex', booktabs=T, caption='Deliveries recorded on nest cameras',
table.envir = "capctable",
col.names=c('Site', 'First delivery recorded', 'Last delivery recorded', 'N. deliveries recorded', 'Deliveries/day'))
# Photos per day?
bind_cols(timespan, n.prey) %>%
mutate(days=as.numeric(days), per.day=prey/days) %>%
round(per.day) %>%
dplyr::select(site, first, last, prey, per.day) %>%
kable('latex', booktabs=T, caption='Deliveries recorded on nest cameras',
table.envir = "capctable",
col.names=c('Site', 'First delivery recorded', 'Last delivery recorded', 'N. deliveries recorded', 'Deliveries/day'))
# Photos per day?
bind_cols(timespan, n.prey) %>%
mutate(days=as.numeric(days), per.day=prey/days) %>%
round() %>%
dplyr::select(site, first, last, prey, per.day) %>%
kable('latex', booktabs=T, caption='Deliveries recorded on nest cameras',
table.envir = "capctable",
col.names=c('Site', 'First delivery recorded', 'Last delivery recorded', 'N. deliveries recorded', 'Deliveries/day'))
# Photos per day?
bind_cols(timespan, n.prey) %>%
mutate(days=as.numeric(days), per.day=prey/days) %>%
mutate(per.day=round(per.day)) %>%
dplyr::select(site, first, last, prey, per.day) %>%
kable('latex', booktabs=T, caption='Deliveries recorded on nest cameras',
table.envir = "capctable",
col.names=c('Site', 'First delivery recorded', 'Last delivery recorded', 'N. deliveries recorded', 'Deliveries/day'))
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load up some libraries
library('tidyverse')
library('lubridate')
library('ggplot2')
library('adehabitatHR')
library('sf')
# Load up the 'new' telemetry data.
df <- read.csv('../data/processed/telemetry_2018-2019.csv', stringsAsFactors=FALSE) %>%
drop_na('lat')
# Do the datetime thing.
df$date <- ymd(df$date)
# I previously defined nestling and fledgling stages.
breeding.2019 <- interval(ymd(20190511), ymd(20190901))
breeding.2018 <- interval(ymd(20180511), ymd(20180901))
# Filter out the breeding season points.
breeding <- df %>% filter(date %within% breeding.2018 | breeding.2019)
# Make it a spatial object, transform to UTM so area makes sense.
breeding <- st_as_sf(breeding, coords=c('lon', 'lat')) %>%
st_set_crs('+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs') %>%
st_transform("+proj=utm +zone=10 +datum=WGS84 +units=m +no_defs")
# Make some 95% MCPs.
mcp.95 <- breeding %>%
dplyr::select(id, geometry) %>%
as_Spatial() %>%
mcp(percent=95, unin='m', unout='ha')
mean.area <- breeding %>% filter(id %in%
c('HAR09', 'HAR04', 'HAR05', 'HAR07')) %>%
dplyr::select(id, geometry) %>%
as_Spatial() %>%
mcp.area(percent=95, unin='m', unout='ha', plotit=FALSE) %>%
pivot_longer(cols=1:4) %>%
summarize(mean(value))
mean.area
nests <- read.csv('../data/raw/camera_nests_2019.csv', stringsAsFactors=FALSE)
# Make it a spatial object, transform to UTM so area makes sense.
nests.sf <- st_as_sf(nests, coords=c('lon', 'lat')) %>%
st_set_crs('+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs') %>%
st_transform("+proj=utm +zone=10 +datum=WGS84 +units=m +no_defs")
# Buffers are defined using radius. I have area.
# 5339.703 ha -> km2
area.km <- mean.area/100
# 53.39703 km2
# Area -> radius (km2)
radius <- sqrt(area.km/pi)
# 4.122718 km
# Km -> m
radius <- radius*1000
# 4122.718 m
# Now draw the buffers.
buffers <- st_buffer(nests.sf, dist=as.numeric(radius))
# Set CRS for the MCPs, convert to a sf object.
mcp.95 <- st_as_sf(mcp.95) %>%
st_set_crs("+proj=utm +zone=10 +datum=WGS84 +units=m +no_defs")
# Stick the relevant sites in their own objects.
int.buff <- buffers %>% filter(site %in% c('TCR', 'RLK', 'MTC'))
int.mcp <- mcp.95 %>% filter(id %in% c('HAR07', 'HAR04', 'HAR09'))
# Find the intersection.
intersections <- st_intersection(int.buff, int.mcp)
# What percent of the "true" MCP is included in the "ideal" circle?
round(st_area(intersections)/st_area(int.mcp)*100)
ggplot() +
geom_sf(data=int.mcp, fill='red') +
geom_sf(data=int.buff, fill='lightblue') +
geom_sf(data=intersections, fill='lightgreen') +
theme_classic()
# Extract the relevant buffers.
l.buff <- buffers %>% filter(site %in% c('TMC', 'UTZ', 'MTF')) %>%
dplyr::select(site, geometry)
# Extract the relevant MCPs and rename to sites.
l.mcp <- mcp.95 %>% filter(id %in% c('HAR04', 'HAR09', 'HAR07')) %>%
mutate(id=as.character(id),
site=case_when(
id == 'HAR04' ~ 'RLK',
id == 'HAR09' ~ 'MTC',
id == 'HAR07' ~ 'TCR',
TRUE ~ id
)) %>%
dplyr::select(site, geometry)
# And bind them together.
landscapes <- rbind(l.buff, l.mcp)
# Export to shapefile for use in QGIS.
st_write(landscapes, '../data/interim/camera_homerange_2019.shp')
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library('knitr')
library('kableExtra')
library('tidyverse')
library('lubridate')
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
source('../src/prey_attributes.R')
# Calculate days.
timespan <- df %>% filter(interest %in% c('delivery', 'newprey')) %>% group_by(site) %>%
summarize(first=min(datetime), last=max(datetime)) %>%
mutate(first=date(first), last=date(last)) %>%
mutate(days=difftime(last, first))
n.prey <- df %>% filter(interest %in% c('delivery', 'newprey')) %>% group_by(site) %>% summarize(prey=n())
# Photos per day?
bind_cols(timespan, n.prey) %>%
mutate(days=as.numeric(days), per.day=prey/days) %>%
mutate(per.day=round(per.day)) %>%
dplyr::select(site, first, last, prey, per.day) %>%
kable('latex', booktabs=T, caption='Deliveries recorded on nest cameras',
table.envir = "capctable",
col.names=c('Site', 'First delivery recorded', 'Last delivery recorded', 'N. deliveries', 'Deliveries/day'))
dt <- read.csv('../data/raw/total_data_twisted.csv', stringsAsFactors=FALSE) %>%
replace(is.na(.), ' ')
# kable(dt, 'latex', booktabs=T, caption='Summary of available sites',
#       table.envir = "capctable",
#       col.names=
#         c('Site', 'Name', 'Type', 'Date', 'N', 'Date', 'N', 'Date', 'N', 'Date', 'Comments')) %>%
#   kable_styling(latex_options=c('scale_down')) %>%
#   add_header_above(c(' '=3, 'Physical remains'=2, 'Cameras'=2, 'Telemetry'=2, 'Occupancy'=1, ' '=1)) %>%
#   landscape(margin = c('1cm'))
kable(dt, 'latex', booktabs=T, caption='Summary of available data',
table.envir = "capctable",
col.names=
c('Site', 'Name', 'Int', 'Ext', 'Phys. rem.', 'Cameras', '2018 M', '2018 F', '2019 M', '2019 F', '2015', '2016', '2017', '2018', '2019')) %>%
kable_styling(latex_options=c('scale_down', 'striped')) %>%
add_header_above(c(' '=2, 'Type'=2, 'Diet'=2, 'Telemetry'=4, 'Occupancy'=5)) %>%
landscape(margin = c('1cm'))
# Do the calculations
mass.table <- items %>% mutate(mass=as.numeric(mass)) %>%
# Calculate totall biomass & total count.
mutate(t.biomass=sum(mass), t.n=n()) %>%
group_by(common) %>%
# Calcuate biomass and count by group.
# Calculate percent biomass and count by group.
mutate(n=n(), biomass=sum(mass), p.biomass=(biomass/t.biomass*100),
p.n=(n/t.n*100))
# Make a pretty table.
prey.table <- mass.table %>% arrange(class, group, genus) %>%
unite(name, 4:5, sep=' ', remove=FALSE) %>%
mutate(name=case_when(
name == 'Unknown unknown' ~ ' ',
TRUE ~ name
)) %>%
dplyr::select(common, name, n, p.n, p.biomass) %>%
distinct()
# Print it out.
prey.table %>%
kable('latex', booktabs=T, caption='Summary of nest camera data',
table.envir = "capctable", col.names=(c('Prey species', '', 'count', '% count', '% biomass')),
digits=2) %>%
kable_styling(full_width=TRUE) %>%
column_spec(1, width='20em') %>%
column_spec(2, italic=T, width='20em') %>%
pack_rows('Large birds (> 150 g)', 1, 3) %>%
pack_rows('Medium birds (60-150 g)', 4, 8) %>%
pack_rows('Small birds (< 40 g)', 9, 10) %>%
pack_rows('Large mammals (> 600 g)', 11, 12) %>%
pack_rows('Medium mammals (200-600 g)', 13, 18) %>%
pack_rows('Small mammals (< 200 g)', 19, 22) %>%
pack_rows('Unidentified items', 23, 24)
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
library('ggplot2')
df <- read.csv('../data/raw/20200424_specimens.csv', stringsAsFactors=FALSE)
View(df)
df %>% group_by(site) %>%
summarize(n())
# How many sites & samples?
df %>% group_by(site) %>%
summarize(n())
df %>% group_by(class) %>%
summarize(n())
df %>% group_by(class) %>%
mutate(total=n())
df %>% mutate(total=n()) %>%
group_by(class) %>%
mutate(t.class=n())
df %>% mutate(total=n()) %>%
group_by(class) %>%
mutate(t.class=n(), prop=t.class/total) %>%
dplyr::select(class, prop)
df %>% mutate(total=n()) %>%
group_by(class) %>%
mutate(t.class=n(), prop=t.class/total) %>%
dplyr::select(class, prop) %>%
distinct()
df %>% mutate(total=n()) %>%
group_by(class) %>%
mutate(t.class=n(), prop=t.class/total) %>%
dplyr::select(class, prop) %>%
distinct()
df %>% group_by(class, family, genus, species) %>%
summarize(n())
df %>% mutate(total=n()) %>%
filter(Family != 'U')
df %>% mutate(total=n()) %>%
filter(family != 'U')
df %>% mutate(total=n()) %>%
filter(family != 'U') %>%
mutate(t.family=n(), p.family=t.family/total)
df %>% mutate(total=n()) %>%
filter(family != 'U') %>%
mutate(t.family=n(), p.family=t.family/total*100) %>%
filter(genus != 'U') %>%
mutate(t.genus=n(), p.genus=t.genus/total*100) %>%
dplyr::select(p.family, p.genus)
df %>% mutate(total=n()) %>%
filter(family != 'U') %>%
mutate(t.family=n(), p.family=t.family/total*100) %>%
filter(genus != 'U') %>%
mutate(t.genus=n(), p.genus=t.genus/total*100) %>%
dplyr::select(p.family, p.genus) %>%
distinct()
# What percent was IDed to family and genus/species?
df %>% mutate(total=n()) %>%
filter(family != 'U') %>%
mutate(t.family=n(), p.family=t.family/total*100) %>%
filter(genus != 'U') %>%
mutate(t.genus=n(), p.genus=t.genus/total*100) %>%
dplyr::select(p.family, p.genus) %>%
distinct()
df %>% group_by(class, family, genus, species) %>%
summarize(n())
df %>% group_by(class, family, genus, species) %>%
summarize(n())
pr <- read.csv('../data/raw/20200424_specimens.csv', stringsAsFactors=FALSE)
pr %>% group_by(site) %>%
summarize(n()) %>%
kable('latex', booktabs=T, caption='Deliveries recorded on nest cameras',
table.envir = "capctable",
col.names=c('Class', 'Family', 'Genus', 'Species', 'N'))
pr %>% group_by(site) %>%
summarize(n()) %>%
kable('latex', booktabs=T, caption='Deliveries recorded on nest cameras',
table.envir = 'capctable',
col.names=c('Class', 'Family', 'Genus', 'Species', 'N'))
pr %>% group_by(site) %>%
summarize(n())# %>%
pr %>% group_by(class, family, genus, species) %>%
summarize(n()) %>%
kable('latex', booktabs=T, caption='Deliveries recorded on nest cameras',
table.envir = 'capctable',
col.names=c('Class', 'Family', 'Genus', 'Species', 'N'))
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
n.nests <- df %>% distinct(site) %>% summarize(n()) %>% as.numeric()
install.date <- df %>% group_by(site) %>% summarize(d=min(datetime)) %>%
mutate(day=day(d), m=month(d))
# Import prey items data
source('../src/prey_attributes.R')
# Import basic camera nest data
cameras <- read.csv('../data/raw/productivity_2019.csv', stringsAsFactors=FALSE)
# Do the date conversion thing.
cameras <- cameras %>% mutate(date=ymd(date), branch=ymd(branch), fledge=ymd(fledge))
# How many fledged?
n.fledge <- cameras %>% group_by(n_fledge) %>%
summarize(n=n())
# How many deliveries?
n.del <- df %>% filter(interest %in% c('newprey', 'delivery')) %>% nrow()
# How many identified to class?
n.to.class <- items %>% filter(class != 'Unknown') %>% nrow()
# How many idetnified to genus?
n.to.genus <- items %>% filter(genus != 'Unknown') %>% nrow()
# Number (count) of deliveries per day.
del.per.day <- df %>% filter(interest %in% c('delivery', 'newprey')) %>%
mutate(day=date(datetime)) %>%
group_by(site) %>%
mutate(first=min(day), last=max(day), n.day=last-first) %>%
add_count(site, day, name='n.del') %>%
add_count(site, name='t.del') %>%
mutate(n.day=as.numeric(n.day), per.day=t.del/n.day) %>%
dplyr::select(site, day, n.day, n.del, t.del) %>%
distinct() %>%
complete(nesting(site), day=seq(min(day), max(day), by='day')) %>%
fill(n.day, t.del) %>%
mutate(n.del=replace_na(n.del, 0))
source('../src/prey_attributes_date.R')
# Amount (biomass) of deliveries per day.
mass.by.day <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass)) %>%
dplyr::select(site, date, d.mass) %>%
arrange(site, date) %>%
distinct() %>%
ungroup() %>% group_by(site) %>%
complete(nesting(site), date=seq(min(date), max(date), by='day')) %>%
mutate(d.mass=replace_na(d.mass, 0))
# Import nest data.
nests <- read.csv('../data/raw/camera_nests_2019.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
nests <- nests %>% mutate(est_hatch=ymd(est_hatch))
# Table with date and age for each site.
age <- nests %>% dplyr::select(site, est_hatch) %>%
mutate(fledge=est_hatch + 99) %>%
pivot_longer(cols=2:3) %>%
group_by(site) %>%
complete(nesting(site), value=seq(min(value), max(value), by='day')) %>%
mutate(age=seq(1:100), date=value) %>%
dplyr::select(site, date, age)
# Re-digest mass data into model-friendly format.
mass.for.model <- items.alt %>% mutate(date=date(datetime)) %>%
group_by(site, date) %>%
mutate(d.mass=sum(mass), log.d.mass=log(d.mass)) %>%
pivot_wider(names_from=class, values_from=mass, values_fill=list(mass=0)) %>%
mutate(Aves=sum(Aves), Mammalia=sum(Mammalia), Unknown=sum(Unknown)) %>%
arrange(site, date) %>%
dplyr::select(site, date, Aves, Mammalia, Unknown, d.mass, log.d.mass) %>%
distinct() %>%
mutate(p.mammal=Mammalia/d.mass)
# Now graft them together.
mass.for.model <- left_join(mass.for.model, age) %>%
mutate(age=as.numeric(age))
# And make a model.
m.mass.by.age <- lm(log.d.mass ~ age, data=mass.for.model)
