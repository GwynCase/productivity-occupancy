knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
# Load up some libraries.
library('tidyverse')
library('lubridate')
library('questionr')
library('ggplot2')
library('knitr')
library('kableExtra')
# Import the data.
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
# Do the datetime thing.
df <- df %>% mutate(datetime=parse_date_time(datetime,
orders=c('%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M:%S')))
source('../src/prey_attributes.R')
to.genus <- items %>% filter(genus != 'Unknown')
to.family <- items %>% filter(family != 'Unknown')
to.class <- items %>% filter(class != 'Unknown')
count.by.genus <- to.genus %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=n()) %>%
group_by(site, genus, species) %>%
mutate(count=n()) %>%
distinct() %>%
ungroup() %>%
mutate(prop=count/total) %>%
dplyr::select(site, class, family, genus, species, count, total, prop) %>%
arrange(site, class)
count.by.genus %>% dplyr::select(-site, -total) %>%
kable(digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 7) %>%
pack_rows('Mount Ford', 8, 14) %>%
pack_rows('Ruby Lake', 15, 16) %>%
pack_rows('Turbid Creek', 17, 22) %>%
pack_rows('Twenty-Mile Creek', 23, 25) %>%
pack_rows('Utziletz', 26, 33)
count.by.family <- to.family %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=n()) %>%
group_by(site, family) %>%
mutate(count=n()) %>%
ungroup() %>%
mutate(prop=count/total) %>%
dplyr::select(site, class, family, count, total, prop) %>%
arrange(site, class) %>%
distinct()
count.by.family %>% dplyr::select(-site, -total) %>%
kable(digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 4) %>%
pack_rows('Mount Ford', 5, 9) %>%
pack_rows('Ruby Lake', 10, 12) %>%
pack_rows('Turbid Creek', 13, 18) %>%
pack_rows('Twenty-Mile Creek', 19, 22) %>%
pack_rows('Utziletz', 23, 27)
count.by.class <- to.class %>%
group_by(site) %>%
mutate(total=n()) %>%
group_by(site, class) %>%
mutate(count=n()) %>%
ungroup() %>%
mutate(prop=count/total) %>%
dplyr::select(site, class, count, total, prop) %>%
arrange(site, class) %>%
distinct()
count.by.class %>% dplyr::select(-site, -total) %>%
kable(digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 2) %>%
pack_rows('Mount Ford', 3, 4) %>%
pack_rows('Ruby Lake', 5, 6) %>%
pack_rows('Turbid Creek', 7, 8) %>%
pack_rows('Twenty-Mile Creek', 9, 10) %>%
pack_rows('Utziletz', 11, 12)
mass.by.genus <- to.genus %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
group_by(site, genus, species) %>%
mutate(amount=sum(mass)) %>%
ungroup() %>%
mutate(prop=amount/total) %>%
dplyr::select(site, class, family, genus, species, amount, total, prop) %>%
arrange(site, class) %>%
distinct()
mass.by.genus %>% dplyr::select(-site, -total) %>%
kable(digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 7) %>%
pack_rows('Mount Ford', 8, 14) %>%
pack_rows('Ruby Lake', 15, 16) %>%
pack_rows('Turbid Creek', 17, 22) %>%
pack_rows('Twenty-Mile Creek', 23, 25) %>%
pack_rows('Utziletz', 26, 33)
mass.by.family <- to.family %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
group_by(site, family) %>%
mutate(amount=sum(mass)) %>%
ungroup() %>%
mutate(prop=amount/total) %>%
dplyr::select(site, class, family, amount, total, prop) %>%
arrange(site, class) %>%
distinct()
mass.by.family %>% dplyr::select(-site, -total) %>%
kable(digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 4) %>%
pack_rows('Mount Ford', 5, 9) %>%
pack_rows('Ruby Lake', 10, 12) %>%
pack_rows('Turbid Creek', 13, 18) %>%
pack_rows('Twenty-Mile Creek', 19, 22) %>%
pack_rows('Utziletz', 23, 27)
mass.by.class <- to.class %>% mutate(mass=as.numeric(mass)) %>%
group_by(site) %>%
mutate(total=sum(mass)) %>%
group_by(site, class) %>%
mutate(amount=sum(mass)) %>%
ungroup() %>%
mutate(prop=amount/total) %>%
dplyr::select(site, class, amount, total, prop) %>%
arrange(site, class) %>%
distinct()
mass.by.class %>% dplyr::select(-site, -total) %>%
kable(digits=2) %>%
kable_styling(full_width=TRUE) %>%
pack_rows('Mount Currie', 1, 2) %>%
pack_rows('Mount Ford', 3, 4) %>%
pack_rows('Ruby Lake', 5, 6) %>%
pack_rows('Turbid Creek', 7, 8) %>%
pack_rows('Twenty-Mile Creek', 9, 10) %>%
pack_rows('Utziletz', 11, 12)
day <- c(1, 1, 2, 2, 4, 4)
n.chicks <- c(2, NA, 1, NA, 2, 1)
data.frame(day, n.chicks)
day <- c(1, 2, 3, 4)
n.chicks <- c(2, 2, 2, 1)
data.frame(day, n.chicks)
library('tidyverse')
library('lubridate')
df <- read.csv('../data/interim/camera_corrected.csv', stringsAsFactors=FALSE)
chicks <- df %>% mutate(date=date(datetime)) %>%
dplyr::select(site, date, live.chicks) %>%
drop_na() %>%
group_by(site, date) %>%
summarize(max(live.chicks)) %>%
ungroup() %>% group_by(site) %>%
complete(nesting(site), date=seq(min(date), max(date), by='day'))
head(chicks)
x1 <- c(2, 2, 2, 2, 2, 1, 1, 1, 1)
x2 <- c(2, 2, 2, 1, 1, 1, 2, 2, 2)
x3 <- c(3, 3, 2, 1, 2, 1, 2, 1, 0)
fix_errors <- function (x) rev(cummax(rev(x)))
print("x1")
x1
fix_errors(x1)
print("x2")
x2
fix_errors(x2)
print("x3")
x3
fix_errors(x3)
library('conflicted')
install.packages(conflicted)
install.packages('conflicted')
library('conflicted')
conflict_prefer("select", "dplyr")
camera_obs <- read_csv('../data/interim/camera_corrected.csv', guess_max = 10000)
live_chicks_all_before_fill <-
camera_obs %>%
mutate(date = date(datetime)) %>%
select(site, date, live.chicks)
live_chicks_all_after_fill <-
live_chicks_all_before_fill %>%
group_by(site) %>%
fill(live.chicks, .direction = "downup")
View(live_chicks_all_before_fill)
View(live_chicks_all_after_fill)
live_chicks_all <-
live_chicks_all_after_fill %>%
mutate(live.chicks = fix_errors(live.chicks))
View(live_chicks_all)
live_chicks_per_day <-
live_chicks_all %>%
group_by(site, date) %>%
summarise(live.chicks = floor(median(live.chicks))) %>%
complete(site, date = full_seq(date, period = 1)) %>%
fill(live.chicks, .direction = "down")
View(live_chicks_per_day)
# Let's try with max chicks per day.
per.day <-
live_chicks_all %>%
group_by(site, date) %>%
summarise(live.chicks = max(live.chicks))) %>%
# Let's try with max chicks per day.
per.day <-
live_chicks_all %>%
group_by(site, date) %>%
summarise(live.chicks = max(live.chicks)) %>%
complete(site, date = full_seq(date, period = 1)) %>%
fill(live.chicks, .direction = "down")
View(live_chicks_per_day)
View(per.day)
df %>% filter(site=='TMC') %>%
select(date, live.chicks)
df %>% dplyr::filter(site=='TMC') %>%
select(date, live.chicks)
live_chicks_all_after_fill %>% dplyr::filter(site=='TMC')
live_chicks_all_after_fill %>% dplyr::filter(site=='TMC') %>%
group_by(date, live.chicks) %>%
summarize(n())
TMC <- live_chicks_all_after_fill %>% dplyr::filter(site=='TMC') %>%
group_by(date, live.chicks) %>%
summarize(n())
View(TMC)
library('ggplot')
library('ggplot2')
group=site, color=site)) +
geom_line() +
theme_classic()
ggplot(live_chicks_all_after_fill, aes(x=date, y=live.chicks,
group=site, color=site)) +
geom_line() +
theme_classic()
ggplot(live_chicks_per_day, aes(x=date, y=live.chicks,
group=site, color=site)) +
geom_line() +
theme_classic()
ggplot(live_chicks_per_day, aes(x=date, y=live.chicks,
group=site, color=site)) +
geom_line(aes(size=1.5, alpha=0.5)) +
theme_classic()
ggplot(live_chicks_per_day, aes(x=date, y=live.chicks)) +
geom_line() +
facet_wrap(~site)
