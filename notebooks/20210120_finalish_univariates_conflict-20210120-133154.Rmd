---
title: "Finalish univariates"
output: html_notebook
---

```{r options, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE)
```

This is just a repeat of an earlier notebook, but now I have my final territory quality dataset so it's no longer  rough draft.

```{r message=FALSE, warning=FALSE}
# Import conflict settings.
source('../src/conflicted.R')

#Load some libraries.
library(tidyverse)
library(vegan)
library(raster)
library(sf)
library(landscapemetrics)
library(broom)
library(knitr)
library(kableExtra)
library(GGally)
library(extrafont)
library(QuantPsyc)
```

Start by defining the four landscape scales.

```{r landscape-scales}
# Area is in hectares.
landscape <- data.frame(
  size=c('PFA', 'breeding area', 'home range', 'maximum range'),
  area=c(60, 200, 3800, 15600)
)

# Convert area in hectares to radii in meters.
landscape <- landscape %>% mutate(radius=sqrt(area*10000/pi))

landscape
```

Then load in occupancy data. This finally has the data from 2020 included. I also filter out all sites with a single year of survey data, since occupied sites are more likely to be detected so there is a bias towards one-year-occupieds.

In this data set, 0 = no surveys conducted, 1 = surveyed but no NOGO detected, 2 = NOGO detected but no breeding, and 3 = breeding.

```{r message=FALSE}
# Read in the data.
occupancy <- read_csv('../data/processed/occupancy_sc.csv')

# Calculate number of years NOGO detected out of number of years surveyed.
occupied <- occupancy %>% pivot_longer(-c(site, name), names_to='year', values_to='status') %>%
  filter(status > 0) %>% 
  group_by(site, status) %>% 
  add_tally() %>% 
  distinct(site, status, .keep_all=TRUE) %>% 
  select(-year) %>% 
  pivot_wider(names_from=status, values_from=n, values_fill=0) %>% 
  ungroup() %>% rowwise(site, name) %>% 
  mutate(years.surveyed=sum(c(`3`, `2`, `1`)),
         years.occupied=sum(c(`3`, `2`)),
         years.empty=years.surveyed-years.occupied,
         proportion.occupied=years.occupied/years.surveyed) %>% 
  select(site, name, years.surveyed, years.occupied, years.empty, proportion.occupied) %>% 
  filter(years.surveyed > 1)

# Look at it.
occupied
```
